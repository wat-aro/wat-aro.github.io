<!DOCTYPE html><html lang="ja"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Posts | (wat-aro)</title><meta name="title" content="(wat-aro)"/><meta name="description"/><meta property="og:locale" content="ja_jp"/><meta property="og:type" content="article"/><meta property="og:site_name" content="(wat-aro)"/><meta property="og:title" content="(wat-aro)"/><meta property="og:image" content="https://wat-aro.dev/images/profile.jpg"/><meta property="og:url" content="https://wat-aro.dev/posts/pages/6"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@wat_aro"/><meta name="twitter:creator" content="@wat_aro"/><meta name="twitter:title" content="(wat-aro)"/><meta name="twitter:description"/><meta name="twitter:image" content="https://wat-aro.dev/images/profile.jpg"/><meta name="next-head-count" content="17"/><link rel="icon" href="/images/favicon.ico"/><link rel="preload" href="/_next/static/css/7c83ce157486acf1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7c83ce157486acf1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-fc7d2f0e2098927e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f557e2d34bba2226.js" defer=""></script><script src="/_next/static/chunks/pages/posts/pages/%5Bpage%5D-c3e4d8daf70d966d.js" defer=""></script><script src="/_next/static/vDqnfS-2Qy9jo2afqVhBT/_buildManifest.js" defer=""></script><script src="/_next/static/vDqnfS-2Qy9jo2afqVhBT/_ssgManifest.js" defer=""></script><script src="/_next/static/vDqnfS-2Qy9jo2afqVhBT/_middlewareManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MW6D56L" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next"><div class="py-0 md:px-8 min-h-screen flex flex-col items-center"><div class="top-0 bg-white w-full h-16 flex flex-row justify-between items-center px-4 border-b-2"><a href="/"><div class="flex items-center font-midium text-3xl h-full font-bold gap-4"><img class="rounded-full" src="/images/profile.jpg" width="48" height="48" alt="profile image"/>(wat-aro)<!-- --></div></a><ul class="flex gap-3 h-full"><li class="h-full  flex flex-col justify-end border-black pb-4"><a href="/about">About</a></li><li class="h-full  flex flex-col justify-end border-black pb-3 border-b-4"><a href="/posts/pages/1">Blog</a></li></ul></div><div class="flex md:justify-center justify-between w-full"><div class="flex flex-col sm:max-w-sm md:max-w-4xl w-full py-4 px-4"><h1 class="text-3xl mb-4">Posts</h1><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%205.02"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 5.02</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/22</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%205.01"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 5.01</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/21</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.77"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.77</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/21</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.76"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.76</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/21</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.75"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.75</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/21</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.74"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.74</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/21</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.73"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.73</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/21</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.72"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.72</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/21</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.71"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.71</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/21</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%204.4.4%20%E8%B3%AA%E5%95%8F%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%AE%E5%AE%9F%E8%A3%85"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 4.4.4 質問システムの実装</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/21</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/%E7%B6%99%E7%B6%9A%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%95%E3%82%A3%E3%83%9C%E3%83%8A%E3%83%83%E3%83%81%E6%95%B0%E5%88%97%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">継続を使ってフィボナッチ数列を求める</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/19</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%204.4.4%20extend-if-consistent%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 4.4.4 extend-if-consistentのエラー</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/19</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.70"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.70</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/18</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.69"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.69</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/18</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.68"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.68</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/18</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.67"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.67</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/17</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.66"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.66</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/17</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.65"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.65</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/17</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.64"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.64</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/17</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/SICP%20%E5%95%8F%E9%A1%8C%204.63"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">SICP 問題 4.63</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/01/17</div></div></a><div class="flex gap-4 py-4 justify-center"><a href="/posts/pages/1">1<!-- --></a><a href="/posts/pages/2">2<!-- --></a><a href="/posts/pages/3">3<!-- --></a><a href="/posts/pages/4">4<!-- --></a><a href="/posts/pages/5">5<!-- --></a><div class="font-bold">6<!-- --></div><a href="/posts/pages/7">7<!-- --></a><a href="/posts/pages/8">8<!-- --></a><a href="/posts/pages/9">9<!-- --></a><a href="/posts/pages/10">10<!-- --></a><a href="/posts/pages/11">11<!-- --></a><a href="/posts/pages/12">12<!-- --></a><a href="/posts/pages/13">13<!-- --></a><a href="/posts/pages/14">14<!-- --></a><a href="/posts/pages/15">15<!-- --></a><a href="/posts/pages/16">16<!-- --></a><a href="/posts/pages/17">17<!-- --></a><a href="/posts/pages/18">18<!-- --></a><a href="/posts/pages/19">19<!-- --></a><a href="/posts/pages/20">20<!-- --></a><a href="/posts/pages/21">21<!-- --></a><a href="/posts/pages/22">22<!-- --></a></div></div></div><div class="flex md:justify-center w-full"><div class="flex flex-col md:max-w-4xl w-full"><hr/><div class="flex justify-center pt-4 pb-8">© 2022 wat-aro</div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"data":{"title":"SICP 問題 5.02","published":"2016/01/22","tags":["scheme","SICP"]},"content":"\n\u003cp\u003e5.01の反復的な階乗計算機をレジスト計算機言語使って記述する．\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econtroller\n factorial\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassign n \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eop \u003cspan class=\"synIdentifier\"\u003eread\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassign product \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econst \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassign counter \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econst \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n test-b\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etest \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eop \u003cspan class=\"synIdentifier\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ereg counter\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ereg n\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebranch \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003elabel factorial-done\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassign t \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eop mul\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ereg product\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ereg counter\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassign u \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eop sum\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ereg counter\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econst \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassign product \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ereg t\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassign counter \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ereg u\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003egoto \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003elabel test\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n factorial-done\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003e基本的に制御器の流れ通り．\u003cbr/\u003e\nreadする方法がわからないので多分こんな感じでしょうってやっつけ\u003c/p\u003e\n\n","slug":"SICP 問題 5.02"},{"data":{"title":"SICP 問題 5.01","published":"2016/01/21","tags":["scheme","SICP"]},"content":"\n\u003cp\u003e\u003cspan itemscope itemtype=\"http://schema.org/Photograph\"\u003e\u003ca href=\"http://f.hatena.ne.jp/wat-aro/20160122154245\" class=\"hatena-fotolife\" itemprop=\"url\"\u003e\u003cimg src=\"http://cdn-ak.f.st-hatena.com/images/fotolife/w/wat-aro/20160122/20160122154245.jpg\" alt=\"f:id:wat-aro:20160122154245j:image\" title=\"f:id:wat-aro:20160122154245j:image\" class=\"hatena-fotolife\" itemprop=\"image\"\u003e\u003c/a\u003e\u003c/span\u003e\u003c/p\u003e\n\n","slug":"SICP 問題 5.01"},{"data":{"title":"SICP 問題 4.77","published":"2016/01/21","tags":["scheme","SICP"]},"content":"\n\u003cp\u003e簡略化して．\u003cbr/\u003e\n(and (not A) B C)を(and B C (not A))に並び替えてからqevalしていく．\u003cbr/\u003e\n入れ子になっていた場合もqevalでまたcojoinに送られるので対処出来る．\u003cbr/\u003e\nただ問題文通りだと，必要な変数を満たす表明が現れたらすぐにnotを実行しなければいけないが，それは難しかったので妥協．\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econjoin conjuncts frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003enew \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebring-filter-behind conjuncts\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eempty-conjunction? new\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      frame-stream\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econjoin \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erest-conjuncts new\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eqeval \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efirst-conjunct new\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                      frame-stream\u003cspan class=\"synSpecial\"\u003e)))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eput \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eand \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eqeval conjoin\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efilter? \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eor\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eeq?\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003enot\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eeq?\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003elisp-value\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebring-filter-behind conjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e iter \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003econjuncts conjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003einfront \u003cspan class=\"synSpecial\"\u003e'())\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebehind \u003cspan class=\"synSpecial\"\u003e'()))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003econd\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enull?\u003c/span\u003e conjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eappend\u003c/span\u003e infront behind\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003efirst \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efirst-conjunct conjuncts\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erest \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erest-conjuncts conjuncts\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n            \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003econd\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003efilter? \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etype first\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n                   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eiter rest infront \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eappend\u003c/span\u003e behind first\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n                  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e\n                   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eiter rest \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eappend\u003c/span\u003e infront first\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e behind\u003cspan class=\"synSpecial\"\u003e)))))))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003e4.78と4.79はパス．\u003c/p\u003e\n\n","slug":"SICP 問題 4.77"},{"data":{"title":"SICP 問題 4.76","published":"2016/01/21","tags":["scheme","SICP"]},"content":"\n\u003cp\u003e本文中のandはひとつ目の質問を満たす表明に対して次の質問を満たす表明をデータベースから探してくる．\u003cbr/\u003e\nそれを２つの質問をそれぞれ満たすストリームをまず作り，\u003cbr/\u003e\n矛盾がないようにそれらを組み合わせるconjoin特殊形式を実装する．\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econjoin conjuncts frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eempty-conjunction? conjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      frame-stream\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003efirst \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eqeval \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efirst-conjunct conjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e frame-stream\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erest \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econjoin \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erest-conjuncts conjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e frame-stream\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econjoin-frame-stream first rest\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econjoin-frame-stream fs1 fs2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-filter\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eframe\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enot\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eeq?\u003c/span\u003e frame \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-flatmap\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eframe1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-map\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eframe2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econjoin-consistent frame1 frame2\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n       fs2\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n    fs1\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\n\u003cspan class=\"synComment\"\u003e;; f2をフレームと考え，f1のvarがf2にあるかを調べる．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; f2にあってf1のvarの値と同じならOK．違えばfailed.なければf2を拡張する．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; 上記手順はexend-if-possibleがやる．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econjoin-consistent f1 f2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enull?\u003c/span\u003e f1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e f2\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eextend-frame2 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend-if-possible \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecaar\u003c/span\u003e f1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdar\u003c/span\u003e f1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e f2\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eeq?\u003c/span\u003e extend-frame2 \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\n            \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econjoin-consistent \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e f1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e extend-frame2\u003cspan class=\"synSpecial\"\u003e)))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eput \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eand \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eqeval conjoin\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; 本文で定義されたextend-if-possible\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; (? x)が値を指していればその値を返す．(? y)となっていれば，さらにその値を探す．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; varもvalも(? x)同じものを指していればfailedが返る．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend-if-possible var val frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ebinding \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-in-frame var frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;フレームからvarに対応するvalを探して束縛\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003econd\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunify-match \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-value binding\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e val frame\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n          \u003cspan class=\"synComment\"\u003e;; 上のletで探してきたvalもまた(? y)という形だった場合は更にフレームから探してくる．\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003evar? val\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ebinding \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-in-frame val frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n             \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e binding\n                 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunify-match var \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-value binding\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend var val frame\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;見つからなければフレームを拡張\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003edepends-on? val var frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e     \u003cspan class=\"synComment\"\u003e;valとvarが同じく(? x)だった場合はfailed\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend var val frame\u003cspan class=\"synSpecial\"\u003e)))))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n","slug":"SICP 問題 4.76"},{"data":{"title":"SICP 問題 4.75","published":"2016/01/21","tags":["scheme","SICP"]},"content":"\n\u003cp\u003e指定した質問を満足する項目がデータベースに一つしかないときに成功する特殊形式uniqueの実装．\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synComment\"\u003e;; streamの個数を調べる．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-length s\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e iter \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003estream s\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n             \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecount \u003cspan class=\"synConstant\"\u003e0\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-null? stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n        count\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eiter \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-cdr stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003e+\u003c/span\u003e count \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunique-query exps\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e exps\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003euniquely-asserted contents frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-flatmap\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eframe\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eresult \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eqeval \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunique-query contents\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esingleton-stream frame\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enot\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-null? result\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n                 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003e=\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-length result\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n            result\n            the-empty-stream\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n    frame-stream\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eput \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eunique \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eqeval uniquely-asserted\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003etest\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synComment\"\u003e;;; Query input:\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunique \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob ?x \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecomputer wizard\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;;; Query result:\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunique \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eBitdiddle Ben\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecomputer wizard\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;;; Query input:\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob ?x ?j\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunique \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob ?anyone ?j\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;;; Query result:\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eAull DeWitt\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadministration secretary\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunique \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eAull DeWitt\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadministration secretary\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eCratchet Robert\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eaccounting scrivener\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunique \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eCratchet Robert\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eaccounting scrivener\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eScrooge Eben\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eaccounting chief accountant\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunique \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eScrooge Eben\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eaccounting chief accountant\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eWarbucks Oliver\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadministration big wheel\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunique \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eWarbucks Oliver\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadministration big wheel\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eReasoner Louis\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecomputer programmer trainee\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunique \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eReasoner Louis\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecomputer programmer trainee\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eTweakit Lem E\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecomputer technician\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunique \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eTweakit Lem E\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecomputer technician\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eBitdiddle Ben\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecomputer wizard\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunique \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ejob \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eBitdiddle Ben\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecomputer wizard\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n","slug":"SICP 問題 4.75"},{"data":{"title":"SICP 問題 4.74","published":"2016/01/21","tags":["scheme","SICP"]},"content":"\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synComment\"\u003e;; negate, lisp-value, singleton-streamはflatten-streamを変更して直列にしても問題ないのではという問題\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; 元のflatten-stream\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eflatten-stream stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-null? stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      the-empty-stream\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003einterleave-delayed\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-car stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edelay\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eflatten-stream \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-cdr stream\u003cspan class=\"synSpecial\"\u003e))))))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; a 差し込みを使わないsimple-flattenの実装\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esimbple-stream-flatmap proc s\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esimple-flatten \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-map proc s\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esimple-flatten stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-map stream-car\n              \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-filter \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003es\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enot\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enull?\u003c/span\u003e s\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n                             stream\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; b\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; negate, lisp-valueはsinbleton-streamを取るので交互にしても直列にしても結果は変わらない．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; find-assertionsの場合はfetch-assertionsで対応する表明を集めてきているので同じく変わらない．\u003c/span\u003e\n\u003c/pre\u003e\n\n\n","slug":"SICP 問題 4.74"},{"data":{"title":"SICP 問題 4.73","published":"2016/01/21","tags":["scheme","SICP"]},"content":"\n\u003cp\u003eflatten-streamが明示的にdelayを使うのはなぜか．\u003cbr/\u003e\n　\u003cbr/\u003e\nflatten-streamはストリームのストリームを引数にとる．\u003cbr/\u003e\n4.71と同じく引数のストリームの中に無限ストリームがあると評価が終わらずになにも印字されないため．\u003c/p\u003e\n\n","slug":"SICP 問題 4.73"},{"data":{"title":"SICP 問題 4.72","published":"2016/01/21","tags":["scheme","SICP"]},"content":"\n\u003cp\u003estream-appendだと最初のストリームが無限ストリームだった場合に次のストリームが評価されなくなる．\nなのでinterleaveにして交互に先頭の要素を評価することで，どちらかもしくは両方が無限ストリームの時に対応できるようにする．\u003c/p\u003e\n\n","slug":"SICP 問題 4.72"},{"data":{"title":"SICP 問題 4.71","published":"2016/01/21","tags":["scheme","SICP"]},"content":"\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synComment\"\u003e;; 本文中のsimple-query\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esimple-query query-pattern frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-flatmap\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eframe\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-append-delayed\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efind-assertions query-pattern frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edelay\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eapply-rules query-pattern frame\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n   frame-stream\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; 本文中のdisjoin\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003edisjoin disjuncts frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eempty-disjunction? disjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      the-empty-stream\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003einterleave-delayed\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eqeval \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efirst-disjunct disjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edelay\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003edisjoin \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erest-disjuncts disjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                       frame-stream\u003cspan class=\"synSpecial\"\u003e)))))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; Louis Reasonerが提案したsimple-query\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esimple-query query-pattern frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-flatmap\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eframe\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-append-delayed\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efind-assertions query-pattern frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eapply-rules query-pattern frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n   frame-stream\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; Louis Reasonerが提案したdisjoin\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003edisjoin disjuncts frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eempty-disjunction? disjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      the-empty-stream\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003einterleave-delayed\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eqeval \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efirst-disjunct disjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003edisjoin \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erest-disjuncts disjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                frame-stream\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; Louis Readonerの提案したものだとinterleaveの二つ目のストリームが遅延されていないので\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; 評価が終わるまで印字されない．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; 仮にruleのほうで無限ループに陥った時に，delayする場合は一つ一つの評価結果を印字しながらループし\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; delayがない場合は何も印字せずに無限ループする．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; 本文でも出てきたmarriedを使って試してみる．\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassert! \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Minnie Mickey\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassert! \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried ?x ?y\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried ?y ?x\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synComment\"\u003e;; delayありの場合\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;;; Query input:\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassert! \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Minnie Mickey\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\nAssertion added to data base.\n\n\u003cspan class=\"synComment\"\u003e;;; Query input:\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassert! \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried ?x ?y\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried ?y ?x\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\nAssertion added to data base.\n\n\u003cspan class=\"synComment\"\u003e;;; Query input:\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey ?x\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;;; Query result:\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey Minnie\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey Minnie\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey Minnie\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey Minnie\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey Minnie\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey Minnie\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey Minnie\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey Minnie\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey Minnie\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey Minnie\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey Minnie\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n...\n\u003c/pre\u003e\n\n\n\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synComment\"\u003e;; delayなしの場合\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;;; Query input:\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassert! \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Minnie Mickey\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\nAssertion added to data base.\n\n\u003cspan class=\"synComment\"\u003e;;; Query input:\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassert! \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried ?x ?y\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried ?y ?x\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\nAssertion added to data base.\n\n\u003cspan class=\"synComment\"\u003e;;; Query input:\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emarried Mickey ?x\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\n\u003c/pre\u003e\n\n\n\u003cp\u003e;;; Query result:\nの表示も出てこない\u003c/p\u003e\n\n","slug":"SICP 問題 4.71"},{"data":{"title":"SICP 4.4.4 質問システムの実装","published":"2016/01/21","tags":["scheme","SICP"]},"content":"\n\u003cp\u003eなかなか処理の流れがわからなかったのでコメントを多めにつけてみた．\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synComment\"\u003e;; 駆動ループ\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e input-prompt \u003cspan class=\"synConstant\"\u003e\u0026quot;;;; Query input:\u0026quot;\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e output-prompt \u003cspan class=\"synConstant\"\u003e\u0026quot;;;; Query result:\u0026quot;\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eprompt-for-input \u003cspan class=\"synIdentifier\"\u003estring\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enewline\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enewline\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003edisplay\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003estring\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enewline\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003equery-driver-loop\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eprompt-for-input input-prompt\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e       \u003cspan class=\"synComment\"\u003e;最初の印字\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eq \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003equery-syntax-process \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eread\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003econd\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eassertion-to-be-added? q\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadd-rule-or-assertion! \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadd-assertion-body q\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enewline\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003edisplay\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e\u0026quot;Assertion added to data base.\u0026quot;\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003equery-driver-loop\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enewline\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003edisplay\u003c/span\u003e output-prompt\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003edisplay-stream\n            \u003cspan class=\"synComment\"\u003e;; このstream-mapで回答のストリームが作られる．\u003c/span\u003e\n            \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-map\n             \u003cspan class=\"synComment\"\u003e;; フレームを取り，変数を具体化したもともとの質問のコピーからなるストリームを作る\u003c/span\u003e\n             \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eframe\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003einstantiate q frame\n                            \u003cspan class=\"synComment\"\u003e;; unbound-handlerに渡す部分．\u003c/span\u003e\n                            \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ev f\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                              \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econtract-question-mark v\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n             \u003cspan class=\"synComment\"\u003e;; 質問を満たすフレームのストリーム\u003c/span\u003e\n             \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eqeval q \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esingleton-stream \u003cspan class=\"synSpecial\"\u003e'()))))\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003equery-driver-loop\u003cspan class=\"synSpecial\"\u003e)))))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; qevalで作られたストリームのフレームをとqを取る．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003einstantiate \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e frame unbound-var-handler\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecopy \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003econd\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003evar? \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synComment\"\u003e;; binding-in-frameで(? x)と対応した((? x) Aull DeWitt)のような形で取り出す．\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ebinding \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-in-frame \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n             \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e binding\n                 \u003cspan class=\"synComment\"\u003e;; 取り出した((? x) Aull DeWitt)を(Aull DeWitt)にしてcopyに渡す．\u003c/span\u003e\n                 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecopy \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-value binding\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n                 \u003cspan class=\"synComment\"\u003e;; (? 5 x)を?x-5に変える\u003c/span\u003e\n                 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunbound-var-handler \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e frame\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003epair?\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003econs\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecopy \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecopy \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;リストの形は維持したままcarとcdrをcopyする\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ecopy \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; 評価機\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eqeval query frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eqproc \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etype query\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eqeval\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;queryがandかorから始まるかのチェック\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e qproc\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eqproc \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econtents query\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;and, orで始まる場合\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esimple-query query frame-stream\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e  \u003cspan class=\"synComment\"\u003e;それ以外\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; 単純質問\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esimple-query query-pattern frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-flatmap\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eframe\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n     \u003cspan class=\"synComment\"\u003e;; carがnullならcdrをforceするappend.find-assertionsでマッチするassertionがなければcdrへ．\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-append-delayed\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efind-assertions query-pattern frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edelay\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eapply-rules query-pattern frame\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n   frame-stream\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; 合成質問\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econjoin conjuncts frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eempty-conjunction? conjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      frame-stream\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econjoin \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erest-conjuncts conjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eqeval \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efirst-conjunct conjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                      frame-stream\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eput \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eand \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eqeval conjoin\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003edisjoin disjuncts frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eempty-disjunction? disjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      the-empty-stream\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003einterleave-delayed\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eqeval \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efirst-disjunct disjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edelay\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003edisjoin \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erest-disjuncts disjuncts\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                       frame-stream\u003cspan class=\"synSpecial\"\u003e)))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eput \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eor \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eqeval disjoin\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; フィルタ\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003enegate operands frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-flatmap\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eframe\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-null? \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eqeval \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003enegated-query operands\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                              \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esingleton-stream frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n         \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esingleton-stream frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n         the-empty-stream\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n   frame-stream\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eput \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003enot \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eqeval negate\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003elisp-value call frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-flatmap\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eframe\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eexecute \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003einstantiate call\n                               frame\n                               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ev f\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                                 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eerror \u003cspan class=\"synConstant\"\u003e\u0026quot;Unknown pat var -- LISP-VALUE\u0026quot;\u003c/span\u003e v\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n         \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esingleton-stream frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n         the-empty-stream\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n   frame-stream\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eput \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003elisp-value \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eqeval lisp-value\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eexecute \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eapply\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eeval\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003epredicate \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e user-initial-environment\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n         \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eargs \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ealways-true ignore frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e frame-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eput \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003ealways-true \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eqeval always-true\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; パターンマッチにより表明を見つける\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efind-assertions pattern frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-flatmap \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003edatum\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003echeck-an-assertion datum pattern frame\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n                  \u003cspan class=\"synComment\"\u003e;; patternの先頭を見て，それにマッチするassertionをストリームで返す．\u003c/span\u003e\n                  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efetch-assertions pattern frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003echeck-an-assertion assertion query-pat query-frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synComment\"\u003e;;パターンマッチされ，failedになったフレームか，拡張されたフレームが入っている．\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ematch-result\n         \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003epattern-match query-pat assertion query-frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eeq?\u003c/span\u003e match-result \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n        the-empty-stream                \u003cspan class=\"synComment\"\u003e;failedなら空のストリームを返す\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esingleton-stream match-result\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;フレームなら空ストリームとcons-streamしたストリームを返す\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; パターンとデータが同じならフレームを返し，パターンが(? x)ならextendするか既にある値を返す．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; マッチしなければそのフレームをfailedにする．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003epattern-match pat dat frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003econd\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eeq?\u003c/span\u003e frame \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eequal?\u003c/span\u003e pat dat\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003evar? pat\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e                     \u003cspan class=\"synComment\"\u003e;patternが(? x)のような形なら\u003c/span\u003e\n         \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend-if-consistent pat dat frame\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;ここで値となって戻るか，拡張されて戻る\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003epair?\u003c/span\u003e pat\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003epair?\u003c/span\u003e dat\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n         \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003epattern-match \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e pat\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e dat\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003epattern-match \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e pat\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                                       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e dat\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                                       frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; varは(? x)のような形で渡される．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend-if-consistent var dat frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ebinding \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-in-frame var frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;assocでframeにvarがあるか探す\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e binding\n        \u003cspan class=\"synComment\"\u003e;; frameにすでにvarがあればそのvalueを返してパターンマッチにかける\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003epattern-match \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-value binding\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e dat frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"synComment\"\u003e;; なければフレームを拡張する．\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend var dat frame\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; 規則とユニフィケーション\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; stream-flatmapはstream-carのストリームをマップしてからstream-cdrにいく\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; interleave-delayedもしているのでcarがnullならばstream-cdrのcarを評価する．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eapply-rules pattern frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-flatmap \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eapply-a-rule rule pattern frame\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n                  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efetch-rules pattern frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;patternで使っているルールを引っ張ってくる\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eapply-a-rule rule query-pattern query-frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eclean-rule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erename-variables-in rule\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;(? x)を(? id x)にしてclean-ruleに束縛\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eunify-result\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunify-match query-pattern\n                        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econclusion clean-rule\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                        query-frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eeq?\u003c/span\u003e unify-result \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n          the-empty-stream\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eqeval \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule-body clean-rule\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esingleton-stream unify-result\u003cspan class=\"synSpecial\"\u003e))))))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; ruleの中で(? x)となっている部分をすべて(? id x)にして返す\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erename-variables-in rule\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003erule-application-id \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003enew-rule-application-id\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;rule-counterに１足してidに保存\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etree-walk \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003econd\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003evar? \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n             \u003cspan class=\"synComment\"\u003e;; (? x)=\u0026gt;(? id x)\u003c/span\u003e\n             \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emake-new-variable \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e rule-application-id\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003epair?\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n             \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003econs\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etree-walk \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n                   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etree-walk \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n            \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etree-walk rule\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; pattern-matchとほぼ同じ．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; ユニファイの場合はフレームに入っている値が(? x)の形の場合もあるのでそれに対応\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunify-match p1 p2 frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003econd\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eeq?\u003c/span\u003e frame \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eequal?\u003c/span\u003e p1 p2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003evar? p1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend-if-possible p1 p2 frame\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003evar? p2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend-if-possible p2 p1 frame\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003epair?\u003c/span\u003e p1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003epair?\u003c/span\u003e p2\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n         \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunify-match \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e p1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e p2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunify-match \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e p1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                                   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e p2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                                   frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; (? x)が値を指していればその値を返す．(? y)となっていれば，さらにその値を探す．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; varもvalも(? x)同じものを指していればfailedが返る．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend-if-possible var val frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ebinding \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-in-frame var frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;フレームからvarに対応するvalを探して束縛\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003econd\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunify-match \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-value binding\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e val frame\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n          \u003cspan class=\"synComment\"\u003e;; 上のletで探してきたvalもまた(? y)という形だった場合は更にフレームから探してくる．\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003evar? val\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ebinding \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-in-frame val frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n             \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e binding\n                 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eunify-match var \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-value binding\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend var val frame\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;見つからなければフレームを拡張\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003edepends-on? val var frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e     \u003cspan class=\"synComment\"\u003e;valとvarが同じく(? x)だった場合はfailed\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003efailed\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend var val frame\u003cspan class=\"synSpecial\"\u003e)))))\u003c/span\u003e\n\n\n\u003cspan class=\"synComment\"\u003e;; vatとexpが同じ(? x)の場合は#tを返す．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003edepends-on? \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e var frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etree-walk e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003econd\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003evar? e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e                     \u003cspan class=\"synComment\"\u003e;(? id x)という形\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eequal?\u003c/span\u003e var e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e           \u003cspan class=\"synComment\"\u003e;varもeも(? x)と同じだった場合\u003c/span\u003e\n               \u003cspan class=\"synConstant\"\u003e#t\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eb \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-in-frame e frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;eの値を更にフレームから探してくる\u003c/span\u003e\n                 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e b\n                     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etree-walk \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-value b\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n                     \u003cspan class=\"synConstant\"\u003e#f\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003epair?\u003c/span\u003e e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eor\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etree-walk \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etree-walk \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e e\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e#f\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etree-walk \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; データベース\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e THE-ASSERTIONS the-empty-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; patternの先頭に合うassertionをストリームにして返す\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efetch-assertions pattern frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003euse-index? pattern\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e              \u003cspan class=\"synComment\"\u003e;patternの先頭がsymbolならtrue\u003c/span\u003e\n      \u003cspan class=\"synComment\"\u003e;; (job ?x ?y)ならjobから始まるデータベースの表明すべてを取ってきてストリームにして返す\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-indexed-assertions pattern\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synComment\"\u003e;; データベースのTHE-ASSERTIONSを返す\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-all-assertions\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-all-assertions\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e THE-ASSERTIONS\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; patternの先頭にマッチするassertionを取ってきてストリームにして返す\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-indexed-assertions pattern\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-stream \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eindex-key-of pattern\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eassertion-stream\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; 表の中からkey1 key2に対応するものを探す\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-stream key1 key2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003es \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget key1 key2\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e s s the-empty-stream\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e THE-RULES the-empty-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efetch-rules pattern frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003euse-index? pattern\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e              \u003cspan class=\"synComment\"\u003e;patternの先頭がsymbolならtrue\u003c/span\u003e\n      \u003cspan class=\"synComment\"\u003e;; patternと先頭の要素が同じruleと先頭が?のruleがstream-appendされて返ってくる．\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-indexed-rules pattern\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-all-rules\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-all-rules\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e THE-RULES\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; patternと先頭の要素が同じruleと先頭の要素が?のruleがstream-appendされる．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-indexed-rules pattern\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-append\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-stream \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eindex-key-of pattern\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003erule-stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-stream \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003e? \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003erule-stream\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; ruleならadd-rule!へ．ruleでなければadd-assertionへ．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadd-rule-or-assertion! assertion\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule? assertion\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadd-rule! assertion\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadd-assertion! assertion\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadd-assertion! assertion\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estore-assertion-in-index assertion\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eold-assertions THE-ASSERTIONS\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eset!\u003c/span\u003e THE-ASSERTIONS\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econs-stream assertion old-assertions\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eok\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadd-rule! rule\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estore-rule-in-index rule\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eold-rules THE-RULES\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eset!\u003c/span\u003e THE-RULES \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econs-stream rule old-rules\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eok\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estore-assertion-in-index assertion\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eindexable? assertion\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ekey \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eindex-key-of assertion\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ecurrent-assertion-stream\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-stream key \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eassertion-stream\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eput key\n               \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eassertion-stream\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econs-stream assertion\n                            current-assertion-stream\u003cspan class=\"synSpecial\"\u003e))))))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; ruleは(rule (some thing else))という形なので(conclusion rule)で(some thing else)という形にしてpatternに束縛する\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; indexiableならrule-streamにkeyを登録する．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estore-rule-in-index rule\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003epattern \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econclusion rule\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e    \u003cspan class=\"synComment\"\u003e;rule本体をpatternに束縛\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eindexable? pattern\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e            \u003cspan class=\"synComment\"\u003e;symbol or ?xのような形で#t\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ekey \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eindex-key-of pattern\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;(? key)なら?,(key)ならkeyをkeyに束縛\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ecurrent-rule-stream\n                 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eget-stream key \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003erule-stream\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e \u003cspan class=\"synComment\"\u003e;'rule-streamの中からkeyのストリームを探す\u003c/span\u003e\n            \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eput key\n                 \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003erule-stream\n                 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econs-stream rule\n                              current-rule-stream\u003cspan class=\"synSpecial\"\u003e)))))))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; symbolか?xのような形ならtrueを返す\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eindexable? pat\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eor\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econstant-symbol? \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e pat\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003evar? \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e pat\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; リストの先頭が?か調べ，?なら?を．違っていれば先頭の要素をそのまま帰す\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eindex-key-of pat\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ekey \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e pat\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003evar? key\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003e? key\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003euse-index? pat\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synComment\"\u003e;; (symbol? (car pat))\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econstant-symbol? \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e pat\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; ストリーム演算\u003c/span\u003e\n\n\n\u003cspan class=\"synComment\"\u003e;; carがnullならcdrをforceするstream-append\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-append-delayed s1 delayed-s2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-null? s1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eforce\u003c/span\u003e delayed-s2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econs-stream\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-car s1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-append-delayed \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-cdr s1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e delayed-s2\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003einterleave-delayed s1 delayed-s2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-null? s1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eforce\u003c/span\u003e delayed-s2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econs-stream\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-car s1\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003einterleave-delayed \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eforce\u003c/span\u003e delayed-s2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n                           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edelay\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-cdr s1\u003cspan class=\"synSpecial\"\u003e))))))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; stream-mapをした後にflatten-streamにかけられる．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; そこでstream-nullなら空ストリームが返る．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; そこからcdrをdelayしてinterleave-delayedに送られる．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; carがnullならcdrはforceされる．\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; nullでなければ第一引数のcarをcons-streamし，\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; delayed-s2,(cdr s2)をintegerleave-delayedで交互にconsしていく．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-flatmap proc s\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eflatten-stream \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-map proc s\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eflatten-stream stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-null? stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      the-empty-stream\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003einterleave-delayed\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-car stream\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edelay\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eflatten-stream \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estream-cdr stream\u003cspan class=\"synSpecial\"\u003e))))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esingleton-stream x\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econs-stream x the-empty-stream\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; 質問の構文手続き\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etype \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003epair?\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eerror \u003cspan class=\"synConstant\"\u003e\u0026quot;Unknown expression TYPE\u0026quot;\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econtents \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003epair?\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eerror \u003cspan class=\"synConstant\"\u003e\u0026quot;Unknown expression CONTENTS\u0026quot;\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; リストの先頭がassert!か判定する\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eassertion-to-be-added? \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eeq?\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etype \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eassert!\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; assert!のbody部を返す．(assert! (some thing else))\u003c/span\u003e\n\u003cspan class=\"synComment\"\u003e;; (contents exp)でcdrを返し，そのcarを返すので(some thing else)になる．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadd-assertion-body \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econtents \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eempty-conjunction? exps\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enull?\u003c/span\u003e exps\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efirst-conjunct exps\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e exps\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erest-conjuncts exps\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e exps\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eempty-disjunction? exps\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enull?\u003c/span\u003e exps\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efirst-disjunct exps\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e exps\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erest-disjuncts exps\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e exps\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003enegated-query exps\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e exps\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003epredicate exps\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e exps\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eargs exps\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e exps\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule? statement\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etagged-list? statement \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003erule\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econclusion rule\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecadr\u003c/span\u003e rule\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule-body rule\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enull?\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecddr\u003c/span\u003e rule\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e'(\u003c/span\u003ealways-true\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecaddr\u003c/span\u003e rule\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003equery-syntax-process \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emap-over-symbols expand-question-mark \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; すべての?xとなっているシンボルを(? x)という形に変える．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emap-over-symbols proc \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003econd\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003epair?\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n         \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003econs\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emap-over-symbols proc \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emap-over-symbols proc \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003esymbol?\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eproc \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; symbolの先頭の文字が?なら(? x)に変える．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eexpand-question-mark symbol\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003echars \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003esymbol-\u0026gt;string\u003c/span\u003e symbol\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003estring=?\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003esubstring\u003c/span\u003e chars \u003cspan class=\"synConstant\"\u003e0\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e\u0026quot;?\u0026quot;\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003elist\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003e?\n              \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003estring-\u0026gt;symbol\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003esubstring\u003c/span\u003e chars \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003estring-length\u003c/span\u003e chars\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n        symbol\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003evar? \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etagged-list? \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003e?\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econstant-symbol? \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003esymbol?\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e rule-counter \u003cspan class=\"synConstant\"\u003e0\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; rule-counterを1増やして返す\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003enew-rule-application-id\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eset!\u003c/span\u003e rule-counter \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003e+\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e rule-counter\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n  rule-counter\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; (? x)=\u0026gt;(? id x)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emake-new-variable var rule-application-id\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003econs\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003e? \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003econs\u003c/span\u003e rule-application-id \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e var\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; (? 5 x)のような形なら\u0026quot;?x-5\u0026quot;にしてから?x-5にする．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econtract-question-mark variable\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003estring-\u0026gt;symbol\u003c/span\u003e\n   \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003estring-append\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e\u0026quot;?\u0026quot;\u003c/span\u003e\n                  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enumber?\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecadr\u003c/span\u003e variable\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n                      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003estring-append\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003esymbol-\u0026gt;string\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecaddr\u003c/span\u003e variable\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n                                     \u003cspan class=\"synConstant\"\u003e\u0026quot;-\u0026quot;\u003c/span\u003e\n                                     \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enumber-\u0026gt;string\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecadr\u003c/span\u003e variable\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n                      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003esymbol-\u0026gt;string\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecadr\u003c/span\u003e variable\u003cspan class=\"synSpecial\"\u003e))))))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; フレームと束縛\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emake-binding variable value\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003econs\u003c/span\u003e variable value\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-variable binding\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e binding\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-value binding\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e binding\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; フレームからvariableに対応したvalueを取り出す．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-in-frame variable frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eassoc\u003c/span\u003e variable frame\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend variable value frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003econs\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emake-binding variable value\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e frame\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003etagged-list? \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e tag\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003epair?\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eeq?\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003eexp\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e tag\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synConstant\"\u003e#f\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n","slug":"SICP 4.4.4 質問システムの実装"},{"data":{"title":"継続を使ってフィボナッチ数列を求める","published":"2016/01/19","tags":["scheme"]},"content":"\n\u003cp\u003ecall/ccの使い方はよくわかってないので自分で継続を渡します．\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efib n\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efib/cc n \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ea b\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003e+\u003c/span\u003e a b\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efib/cc n func\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003econd\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003e=\u003c/span\u003e n \u003cspan class=\"synConstant\"\u003e0\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efunc \u003cspan class=\"synConstant\"\u003e0\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e0\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003e=\u003c/span\u003e n \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efunc \u003cspan class=\"synConstant\"\u003e0\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e\n         \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efunc \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efib/cc \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003e-\u003c/span\u003e n \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e func\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003efib/cc \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003e-\u003c/span\u003e n \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e func\u003cspan class=\"synSpecial\"\u003e)))))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003eテスト．\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003egosh\u0026gt; \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003emap\u003c/span\u003e fib \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eiota \u003cspan class=\"synConstant\"\u003e20\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e0\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e0\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e5\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e8\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e13\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e21\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e34\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e55\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e89\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e144\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e233\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e377\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e610\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e987\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e1597\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2584\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e4181\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\n\n\n","slug":"継続を使ってフィボナッチ数列を求める"},{"data":{"title":"SICP 4.4.4 extend-if-consistentのエラー","published":"2016/01/19","tags":["scheme","SICP","gauche"]},"content":"\n\u003cp\u003e4.4.4の論理型プログラミングの実装を評価すると以下のエラーが出ます．\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003egosh\u0026gt; \u003cspan class=\"synConstant\"\u003e***\u003c/span\u003e ERROR: Compile Error: cannot \u003cspan class=\"synIdentifier\"\u003efind\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e\u0026quot;var\u0026quot;\u003c/span\u003e in \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e\u0026quot;/usr/local/Cellar/gauche/0.9.4/share/gauche-0.9/site/lib\u0026quot;\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e\u0026quot;/usr/local/Cellar/gauche/0.9.4/share/gauche-0.9/0.9.4/lib\u0026quot;\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e\u0026quot;/usr/local/Cellar/gauche/0.9.4/share/gauche/site/lib\u0026quot;\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e\u0026quot;/usr/local/Cellar/gauche/0.9.4/share/gauche/0.9/lib\u0026quot;\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synConstant\"\u003e\u0026quot;(standard input)\u0026quot;\u003c/span\u003e:1:\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend-if-consistent var da ...\n\nStack Trace:\n_______________________________________\n  \u003cspan class=\"synConstant\"\u003e0\u003c/span\u003e  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eeval\u003c/span\u003e expr env\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n        At line \u003cspan class=\"synConstant\"\u003e179\u003c/span\u003e of \u003cspan class=\"synConstant\"\u003e\u0026quot;/usr/local/Cellar/gauche/0.9.4/share/gauche-0.9/0.9.4/lib/gauche/interactive.scm\u0026quot;\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003eこれがextend-if-consistentのコードです．\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend-if-consistent var dat frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003ebinding \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-in-frame var frame\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e binding\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003epattern-match \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ebinding-value binding\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e dat frame\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eextend var dat frame\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003e何も問題ないように思えます．\ndefineなのになぜvarを探しているのかわかりません．\u003cbr/\u003e\n散々迷って，このコードのvarを１つずつ変更していったところ，\u003cbr/\u003e\n最後の行のextendの次のvarを探しているようでした．\u003cbr/\u003e\nelse節なのになぜこんなところが評価されているんだと思いながらも，\u003cbr/\u003e\nこの評価機のextendの定義を先に評価したところ，extend-if-consistentの評価も通りました．\u003cbr/\u003e\n\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Gauche\"\u003eGauche\u003c/a\u003eのextendを調べてみると以下で見つかりました．\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://practical-scheme.net/gauche/man/gauche-refj_34.html\"\u003eGauche \u0026#x30E6;\u0026#x30FC;\u0026#x30B6;\u0026#x30EA;\u0026#x30D5;\u0026#x30A1;\u0026#x30EC;\u0026#x30F3;\u0026#x30B9;: 4.13 \u0026#x30E2;\u0026#x30B8;\u0026#x30E5;\u0026#x30FC;\u0026#x30EB;\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eモジュールの継承で使われるので優先的に評価されているのでしょう．\u003cbr/\u003e\nなのでこの部分は本文中のextendの定義を先に評価してから書くようにします．\u003c/p\u003e\n\n","slug":"SICP 4.4.4 extend-if-consistentのエラー"},{"data":{"title":"SICP 問題 4.70","published":"2016/01/18","tags":["scheme","SICP"]},"content":"\n\u003cp\u003e本文中のadd-assertion!とadd-rules!のletの目的は何か．\n問題文のadd-assertion!ではダメな理由を述べよ．\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synComment\"\u003e;; 本文中のadd-assertion!\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadd-assertion! assertion\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estore-assertion-in-index assertion\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eold-assertions THE-ASSERTIONS\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eset!\u003c/span\u003e THE-ASSERTIONS\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econs-stream assertion old-assertions\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eok\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e;; 問題文のadd-assertion!\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eadd-assertion! assertion\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003estore-assertion-in-index assertion\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eset!\u003c/span\u003e THE-ASSERTIONS\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003econs-stream assertion THE-ASSERTIONS\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003eok\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003econs-streamはcarは評価し，cdrはdelayしてconsしている．\u003cbr/\u003e\nそのため，問題文のadd-assertion!ではset!した時にassertionは評価されているが，THE-ASSERTIONSは評価されていない．   \u003cbr/\u003e\nそれがTHE-ASSERTIONSに代入されるのでもともとのTHE-ASSERTIONSにアクセスできなくなる．  \u003cbr/\u003e\nそれを防ぐために本文中のadd-assertion!とadd-rule!ではset!する前にletで古い値を保存している．\u003c/p\u003e\n\n","slug":"SICP 問題 4.70"},{"data":{"title":"SICP 問題 4.69","published":"2016/01/18","tags":["scheme","SICP"]},"content":"\n\u003cp\u003e((great great grandson) adam Irad)のような質問ができるようにする．\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003egreatson-end ?x\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eappend-to-form ?u \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003egrandson\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?x\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003egrandson\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?x\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003egrandson ?x\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003egreat \u003cspan class=\"synSpecial\"\u003e.\u003c/span\u003e ?rel\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?x ?y\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003egreatson-end ?rel\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eson-of ?x ?z\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?rel ?z ?y\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n","slug":"SICP 問題 4.69"},{"data":{"title":"SICP 問題 4.68","published":"2016/01/18","tags":["scheme","SICP"]},"content":"\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003emy-reverse lst\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e iter \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003elst lst\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eresult \u003cspan class=\"synSpecial\"\u003e'()))\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003enull?\u003c/span\u003e lst\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n        result\n        \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eiter \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecdr\u003c/span\u003e lst\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003econs\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ecar\u003c/span\u003e lst\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e result\u003cspan class=\"synSpecial\"\u003e)))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eappend-to-form \u003cspan class=\"synSpecial\"\u003e()\u003c/span\u003e ?y ?y\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eappend-to-form \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?u \u003cspan class=\"synSpecial\"\u003e.\u003c/span\u003e ?v\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?y \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?u \u003cspan class=\"synSpecial\"\u003e.\u003c/span\u003e ?z\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eappend-to-form ?v ?y ?z\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ereverse\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?x\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?x\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\u003cspan class=\"synError\"\u003eは当然成り立つ．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?x \u003cspan class=\"synSpecial\"\u003e.\u003c/span\u003e ?y\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synError\"\u003e?zの関係で考える．\u003c/span\u003e\n\u003cspan class=\"synError\"\u003e?zの末尾は\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?x\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\u003cspan class=\"synError\"\u003eなので\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eappend\u003c/span\u003e something \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?x\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?z\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synError\"\u003esomethingは残った?yをreverseしたものなので\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ereverse\u003c/span\u003e ?y something\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synError\"\u003e規則として書いてみると\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ereverse\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?x\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?x\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ereverse\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?x \u003cspan class=\"synSpecial\"\u003e.\u003c/span\u003e ?y\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?z\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eappend-to-form ?something ?x ?z\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ereverse\u003c/span\u003e ?y ?something\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"synError\"\u003e実際にリストを入れて確かめてみる．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ereverse\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?z\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synError\"\u003eまず，appendで\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eappend-to-form ?something \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?z\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\u003cspan class=\"synError\"\u003eとなる．\u003c/span\u003e\n\u003cspan class=\"synError\"\u003e次の行で\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ereverse\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?something\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synError\"\u003eappendに進み\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eappend-to-form ?something2 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?something\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ereverse\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?something2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synError\"\u003eappendにいき\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eappend-to-form ?something3 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?something2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ereverse\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?something3\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synError\"\u003eひとつ目の定義から\u003c/span\u003e\n?something3 \u003cspan class=\"synIdentifier\"\u003e=\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eappend-to-form ?something3 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?something2\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\u003cspan class=\"synError\"\u003eなので\u003c/span\u003e\n?something2 \u003cspan class=\"synIdentifier\"\u003e=\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eappend-to-form ?something2 \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?something\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\u003cspan class=\"synError\"\u003eなので\u003c/span\u003e\n?something \u003cspan class=\"synIdentifier\"\u003e=\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eappend-to-form ?something \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?z\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\u003cspan class=\"synError\"\u003eなので\u003c/span\u003e\n?z \u003cspan class=\"synIdentifier\"\u003e=\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synError\"\u003eこれでうまくいくはず．\u003c/span\u003e\n\n\u003cspan class=\"synError\"\u003e次は逆を考えてみる．\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ereverse\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?x \u003cspan class=\"synSpecial\"\u003e.\u003c/span\u003e ?y\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eappend-to-form ?something ?x ?z\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003cspan class=\"synError\"\u003e候補は\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eappend\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e'())(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eappend\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eappend\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eappend\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))(\u003c/span\u003eappend-to-form \u003cspan class=\"synSpecial\"\u003e()\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003cspan class=\"synError\"\u003eここで?x\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003e=\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e()\u003c/span\u003e\u003cspan class=\"synError\"\u003eとすると\u003c/span\u003e\n\u003cspan class=\"synError\"\u003e?somethingは\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003ereverse\u003c/span\u003e ?y \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n\u003cspan class=\"synError\"\u003eここで?z\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003e=\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e2\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e3\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e4\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\u003cspan class=\"synError\"\u003eと同じになるので無限ループになる．\u003c/span\u003e\n\u003cspan class=\"synError\"\u003e他のルートから進んでもかならずこのパターンもチェックするので無限ループは避けられない．\u003c/span\u003e\n\u003c/pre\u003e\n\n\n","slug":"SICP 問題 4.68"},{"data":{"title":"SICP 問題 4.67","published":"2016/01/17","tags":["scheme","SICP"]},"content":"\n\u003cp\u003eフレームに質問の履歴をつけていく．  \u003cbr/\u003e\n入力ストリームと出力ストリームの間で同じ質問(4.64でいう(outranked-by ?staff-person Boss)のような)があれば\u003cbr/\u003e\nループしていると判断して処理を中止するようにする．\u003c/p\u003e\n\n","slug":"SICP 問題 4.67"},{"data":{"title":"SICP 問題 4.66","published":"2016/01/17","tags":["scheme","SICP"]},"content":"\n\u003cp\u003e重複したものをアキュムレートしてしまうのでこのままでは使えないことがわかった．\u003cbr/\u003e\n重複を削除するように変更すればよい．\u003c/p\u003e\n\n","slug":"SICP 問題 4.66"},{"data":{"title":"SICP 問題 4.65","published":"2016/01/17","tags":["scheme","SICP"]},"content":"\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ewheel ?person\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esupervisor ?middle-manager ?person\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esupervisor ?x ?middle-manager\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003ewheelはまず?personにデータベースの先頭から人を束縛して，and以下を満たすかを試していく．\u003cbr/\u003e\nなので\u003cbr/\u003e\nBen -\u003e Oliver -\u003e X\u003cbr/\u003e\nalyssa -\u003e Ben -\u003e Oliver\u003cbr/\u003e\nFect -\u003e Ben -\u003e Oliver\u003cbr/\u003e\nLem -\u003e Ben -\u003e Oliver\u003cbr/\u003e\nLouis -\u003e Alyssa Ben\u003cbr/\u003e\nOliver -\u003e X\u003cbr/\u003e\nEben -\u003e Oliver -\u003e X\u003cbr/\u003e\nRobert -\u003e Eben -\u003e Oliver\u003cbr/\u003e\nDewitt -\u003e Oliver -\u003e X\u003cbr/\u003e\nとなり，Wawrbucks Oliverが４回出力される．\u003c/p\u003e\n\n","slug":"SICP 問題 4.65"},{"data":{"title":"SICP 問題 4.64","published":"2016/01/17","tags":["scheme","SICP"]},"content":"\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eoutranked-by ?staff-person ?boss\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eor\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esupervisor ?staff-person ?boss\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eoutranked-by ?middle-manager ?boss\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esupervisor ?staff-person ?middle-manager\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eoutranked-by \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eBitdiddle Ben\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e ?who\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003eまずoutranked-byの?staff-personにBitdiddle Benが束縛される．\u003cbr/\u003e\n次に(supervisor ?staff-person ?boss)でBitdiddle Benの上司が?bossに束縛される．これを仮にAとする．\u003cbr/\u003e\nそしてoutranked-byが?bossがAとして?middle-managerを探す．※\u003cbr/\u003e\nここから二周目．\u003cbr/\u003e\nsupervisor行で?bossをAとして部下Bが?staff-personに束縛される．\u003cbr/\u003e\nandのoutranked-byで?bossをAとして?middle-managerを探す．\u003cbr/\u003e\n※印をつけたところ同じところを探し始めているのでここで無限ループに陥る．\u003cbr/\u003e\n正しいoutranked-byは以下の通り．\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eoutranked-by ?staff-person ?boss\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eor\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esupervisor ?staff-person ?boss\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003esupervisor ?staff-person ?middle-manager\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eoutranked-by ?middle-manager ?boss\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n","slug":"SICP 問題 4.64"},{"data":{"title":"SICP 問題 4.63","published":"2016/01/17","tags":["scheme","SICP"]},"content":"\n\u003cp\u003eSはGの孫であるという規則の形式化\u003c/p\u003e\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?son son-of ?dad\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eor\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eson ?dad ?son\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ewife ?dad ?mam\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n               \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003eson ?mam ?son\u003cspan class=\"synSpecial\"\u003e))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003erule \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?grandson grandson-of ?granddad\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003eand\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?parent son-of ?grandson\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n           \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e?grandson son-of ?parent\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n","slug":"SICP 問題 4.63"}],"currentPage":6,"pages":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]},"__N_SSG":true},"page":"/posts/pages/[page]","query":{"page":"6"},"buildId":"vDqnfS-2Qy9jo2afqVhBT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>