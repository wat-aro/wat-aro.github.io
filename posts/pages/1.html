<!DOCTYPE html><html lang="ja"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Posts | (wat-aro)</title><meta name="title" content="(wat-aro)"/><meta name="description"/><meta property="og:locale" content="ja_jp"/><meta property="og:type" content="article"/><meta property="og:site_name" content="(wat-aro)"/><meta property="og:title" content="(wat-aro)"/><meta property="og:image" content="https://wat-aro.dev/images/profile.jpg"/><meta property="og:url" content="https://wat-aro.dev/posts/pages/1"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@wat_aro"/><meta name="twitter:creator" content="@wat_aro"/><meta name="twitter:title" content="(wat-aro)"/><meta name="twitter:description"/><meta name="twitter:image" content="https://wat-aro.dev/images/profile.jpg"/><meta name="next-head-count" content="17"/><link rel="icon" href="/images/favicon.ico"/><link rel="preload" href="/_next/static/css/7c83ce157486acf1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7c83ce157486acf1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-fc7d2f0e2098927e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f557e2d34bba2226.js" defer=""></script><script src="/_next/static/chunks/pages/posts/pages/%5Bpage%5D-0f6290e694e304d7.js" defer=""></script><script src="/_next/static/SXcjlEmjiVUOhB_fdC10N/_buildManifest.js" defer=""></script><script src="/_next/static/SXcjlEmjiVUOhB_fdC10N/_ssgManifest.js" defer=""></script><script src="/_next/static/SXcjlEmjiVUOhB_fdC10N/_middlewareManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MW6D56L" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next"><div class="py-0 md:px-8 min-h-screen flex flex-col items-center"><div class="top-0 bg-white w-full h-16 flex flex-row justify-between items-center px-4 border-b-2"><a href="/"><div class="flex items-center font-midium text-3xl h-full font-bold gap-4"><img class="rounded-full" src="/images/profile.jpg" width="48" height="48" alt="profile image"/>(wat-aro)<!-- --></div></a><ul class="flex gap-3 h-full"><li class="h-full  flex flex-col justify-end border-black pb-4"><a href="/about">About</a></li><li class="h-full  flex flex-col justify-end border-black pb-3 border-b-4"><a href="/posts/pages/1">Blog</a></li></ul></div><div class="flex md:justify-center justify-between w-full"><div class="flex flex-col sm:max-w-sm md:max-w-4xl w-full py-4 px-4"><h1 class="text-3xl mb-4">Posts</h1><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/migrate-hatena-blog-posts"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">はてなブログの記事を Next.js 製ブログにインポート</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2022/06/15</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/post-escapted-sharp"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">Next.js で URL に#を含むページを作成する</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2022/06/14</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/japanese-man-page"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">Arch Linux で日本語 man ページと英語 man ページを使い分ける</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2022/05/29</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/wson"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">JSON parser を書いた</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2022/05/27</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/generate-ogimage-by-playwright"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">Playwright で OGP 画像を生成する</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2022/05/24</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/study-nom-by-json"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">json で nom のお勉強</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2022/05/16</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/moved-my-blog-to-github-io"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">ブログを移転しました</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2022/05/15</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/RSP%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%8B%98%E9%81%95%E3%81%84"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">RSPレジスタに対する勘違い</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2021/09/16</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/container%20%E5%86%85%E3%81%A7%20wasm-pack%20test%20%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%81%A8%20bind()%20failed:%20Cannot%20assign%20requested%20address%20(99)%20%E3%81%AB%E3%81%AA%E3%82%8B"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">container 内で wasm-pack test を実行すると bind() failed: Cannot assign requested address (99) になる</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2021/08/25</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/Chrome%20%E3%81%AA%E3%81%A9%E3%81%A7%20Emacs%20%E3%82%AD%E3%83%BC%E3%83%90%E3%82%A4%E3%83%B3%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E4%BD%BF%E3%81%86"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">Chrome などで Emacs キーバインディングを使う</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2020/02/24</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/emacs%20%E3%81%A7%20fcitx-mozc%20%E3%82%92%E4%BD%BF%E3%81%86"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">emacs で fcitx-mozc を使う</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2020/02/23</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/X1%20Carbon%20Gen%207th%20%E3%81%AB%20Arch%20Linux%20%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">X1 Carbon Gen 7th に Arch Linux をインストール</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2020/02/11</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/ActiveModel::Attributes%E3%81%A7%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%BF%E3%82%A4%E3%83%97%E3%82%92%E4%BD%BF%E3%81%86"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">ActiveModel::Attributesでカスタムタイプを使う</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2018/08/07</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/http-conduit%20%E3%81%A7%E5%8F%96%E5%BE%97%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%97%A5%E6%9C%AC%E8%AA%9E%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">http-conduit で取得したデータを日本語表示する</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2018/02/27</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%20Coq%20%E8%A8%BC%E6%98%8E%E9%A7%86%E5%8B%95%E9%96%8B%E7%99%BA(1)"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">プログラミング Coq 証明駆動開発(1)</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2017/05/11</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%20Coq%20(%E8%A8%BC%E6%98%8E%E9%A7%86%E5%8B%95%E9%96%8B%E7%99%BA%202)"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">プログラミング Coq (証明駆動開発 2)</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2017/05/11</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/%E6%8A%80%E8%A1%93%E6%9B%B8%E5%85%B82%E3%81%AB%E8%A1%8C%E3%81%A3%E3%81%A6%E3%81%8D%E3%81%9F"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">技術書典2に行ってきた</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2017/04/09</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/Pathname%2523join%E3%81%AE%E4%B8%8D%E6%80%9D%E8%AD%B0%E3%81%AA%E6%8C%99%E5%8B%95"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">Pathname#joinの不思議な挙動</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2017/01/12</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/%E5%89%B0%E4%BD%99%E3%82%92%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84FizzBuzz"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">剰余を使わないFizzBuzz</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/11/25</div></div></a><a class="border-b-2 border-gray-200 border-opacity-0 hover:border-opacity-100" href="/posts/Rollbar%E3%81%A7bot%E3%81%8C%E5%87%BA%E3%81%99%E3%82%A8%E3%83%A9%E3%83%BC%E3%82%92%E7%84%A1%E8%A6%96%E3%81%99%E3%82%8B"><div class="flex pt-2 pb-1 justify-between"><div class="text-xl md:w-5/6 w-9/12">Rollbarでbotが出すエラーを無視する</div><div class="text-gray-500 md:w-1/6 w-3/12 flex justify-end">2016/10/19</div></div></a><div class="flex gap-4 py-4"><div class="font-bold">1<!-- --></div><a href="/posts/pages/2">2<!-- --></a><a href="/posts/pages/3">3<!-- --></a><a href="/posts/pages/4">4<!-- --></a><a href="/posts/pages/5">5<!-- --></a><a href="/posts/pages/6">6<!-- --></a><a href="/posts/pages/7">7<!-- --></a><a href="/posts/pages/8">8<!-- --></a><a href="/posts/pages/9">9<!-- --></a><a href="/posts/pages/10">10<!-- --></a><a href="/posts/pages/11">11<!-- --></a><a href="/posts/pages/12">12<!-- --></a><a href="/posts/pages/13">13<!-- --></a><a href="/posts/pages/14">14<!-- --></a><a href="/posts/pages/15">15<!-- --></a><a href="/posts/pages/16">16<!-- --></a><a href="/posts/pages/17">17<!-- --></a><a href="/posts/pages/18">18<!-- --></a><a href="/posts/pages/19">19<!-- --></a><a href="/posts/pages/20">20<!-- --></a><a href="/posts/pages/21">21<!-- --></a><a href="/posts/pages/22">22<!-- --></a></div></div></div><div class="flex md:justify-center w-full"><div class="flex flex-col md:max-w-4xl w-full"><hr/><div class="flex justify-center pt-4 pb-8">© 2022 wat-aro</div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"data":{"title":"はてなブログの記事を Next.js 製ブログにインポート","published":"2022/06/15","tags":["Rust","Next.js","TypeScript"]},"content":"\n[旧ブログ](https://wat-aro.hatenablog.com/) の記事の移行が終わりました。\nRust のパーサコンビネータ [nom](https://github.com/Geal/nom) の使いかたに慣れるため [JSON parser](https://github.com/wat-aro/wson) を作ったりと寄り道が激しかったです。\n\nはてなブログから記事をエクスポートすると [Movable Type](https://www.sixapart.jp/movabletype/) で書かれた txt ファイルをダウンロードできます。\nこれを変換して markdown で書いているこのサイトでインポートできるようにしたい。\n[Movable Type のフォーマット](https://www.sixapart.jp/movabletype/manual/3.3/f_import_format/) にちゃんと対応するのは大変なので必要なところだけ対応した。\n\n## movable_type_to_markdown\n\n作った移行ツールがこちら https://github.com/wat-aro/movable_type_to_markdown\n使ったことがなかったので [clap](https://github.com/clap-rs/clap) や [anyhow](https://github.com/dtolnay/anyhow) を使ってみた。\nto_markdown といいつつ、実際は Movable Type ファイルに入っていた html のまま。\n最初は html からマークダウンにしようかと考えていたけれどコードブロックの `pre` タグがめんどくさすぎて断念。\n\n```shell\ncargo run MOVABLE_TYPE_FILE OUTPUT_DIRECTORY\n```\n\nで OUTPUT_DIRECTORY に変換した markdown ファイルを出力できます。\n作りはシンプルに パースして記事用のオブジェクトを作成してファイル作成。\n\n## はまりどころ 1\n\nMovable Type の複数行フィールド・セクションは `-----\\n` によって区切られている。\n本文で `-----------\\n` などが使われている箇所があったためパースできなくなってしまった。\nセパレータは行頭から開始される場合に限るため `\\n-----\\n` で判定することでなんとかなった\n\n## はまりどころ 2\n\nコードブロック以外はそのままの html でそれなりに表示されているのでそれでよしとした。\nただコードブロックはいかんともしがたく。\nこれはこちらのサイト側で対応。\nはてなブログのコードブロックの `pre` タグ直下に `code` タグを入れて children をラップすると、ハイライトされないが改行はきちんと反映されることがわかった。\nただし、markdown で書いたコードブロックを使っているため、`pre` タグのクラス名に `code` が含まれている場合にはてなブログのコードブロックだと判定するようにした。\nこのサイトは `unified` を使ってマークダウンから html に変換している。\n以下の plugin を追加することでコードブロックを表示できるようにした。\n\n```ts\nexport const rehypeHatenaCodeBlock: Plugin = () =\u003e {\n  return (tree, file) =\u003e {\n    visit(tree, 'element', (node: Element) =\u003e {\n      if (\n        node.tagName == 'pre' \u0026\u0026\n        node.properties?.className \u0026\u0026\n        Array.isArray(node.properties.className) \u0026\u0026\n        node.properties.className.includes('code')\n      ) {\n        const children = node.children;\n        const code = {\n          type: 'element',\n          tagName: 'code',\n          properties: {},\n          children: children,\n        } as ElementContent;\n        node.children = [code];\n      }\n      return true;\n    });\n  };\n};\n```\n\n### 今後の展望\n\n今は全件表示されているため、次はページネーションを導入するぞい。\n","slug":"migrate-hatena-blog-posts"},{"data":{"title":"Next.js で URL に#を含むページを作成する","published":"2022/06/14","tags":["Next.js"]},"content":"\n## tl;dr\n\nnext.js で `#` が含まれた static page のリンクは `#` でなく `%2325` にする必要がある。\nアクセスできるようになったが、そもそも URL に `#` を入れないのがよい。\n\n## 事象\n\nはてなブログからの記事を移行する際に、記事のタイトルを markdown のファイル名にしていた。\n`/posts/Array#slice.md` を元に出力した `/posts/Arrray#slice` ページにアクセスしようとすると 404 になってしまう。\n\n## 環境\n\n- Next.js\n\n## 解決策\n\n普通に `#` だけをパーセントエンコーディングしてリンクを生成したところ、 `next dev` で実行する際はうまくいったが、 `next export` してデプロイするとアクセスできない。\n実際に `Next.js` が出力した html を見てみると ファイル名の `#` が html のファイル名の時点で `%25` に変換されていた。\nhttps://github.com/wat-aro/wat-aro.github.io/blob/47a30b9d9a1d03154b7934bfde91f3809b2006cc/posts/Array%2523slice.html\n\nアクセスする際のリンクが `/posts/Array%25slice` だとうまくいかないのはこのせいだった。\nhtml 自体が `/posts/Array%25slice` に配置されているので、ここへアクセスするためには `%25` をさらにパーセントエンコーディングしないといけない。\nURL を生成する際に `#` を `%2325` に変換すると `next export` した際にきちんと動くようになった :smile:\n\nしかし、 `next dev` ではうごかない。\n`next export` -\u003e `#` が変換された html にアクセス\n`next dev` -\u003e `#` を変換していない html にアクセス\nという具合の挙動になっていそう。\n`export` と `dev` でファイル名が違うため環境によって分岐しないと両方で表示できるようにはならない。\n\n`#` が入らないように調整するのが一番よさそうですね。\n","slug":"post-escapted-sharp"},{"data":{"title":"Arch Linux で日本語 man ページと英語 man ページを使い分ける","published":"2022/05/29","tags":["Linux","Arch"]},"content":"\n普段コードを書く環境ではエラーメッセージのググラビリティを考えて locale を英語にしています。\n日本語でエラーメッセージを表示しても同じ問題にひっかかっている issue や StackOverFlow などが出てきづらくなるためです。\nでも man ページを読む際には日本語のほうが楽ですよね。\nしかし日本語の man ページしか見れなくなるのも他の人に共有する際に困ってしまいます。\nここでは日本語と英語の man ページをいい感じに共存する方法を紹介します。\n\nと言ってもやることは単純で\n\n```shell\n$ LANG=ja_JP.UTF-8 yay -S man-pages-ja\n```\n\nで日本語 man をインストールし、\n\n```fish\nabbr --add jman \"LANG=ja_JP.UTF-8 man\"\n```\n\nのように `abbr` を登録するか\n\n```bash\nalias jman='LANG=ja_JP.UTF-8 man'\n```\n\nのように `alias` を登録するだけです。\n`PKGBUILD` を見るとわかるのですが、`man-pages-ja` では環境変数 `LANG` の値を見て日本語 man をインストールするディレクトリを判定しています。\n\n```shell\npackage() {\n    mkdir -p ${pkgdir}/usr/share/man/${LANG}\n    cd ${srcdir}/${pkgname}-${pkgver}\n    make install\n}\n```\n\nそのため `yay -S` する際に `LANG` を渡すことで任意のディレクトリに日本語 man をインストールできるわけです。\nこうすると `man` を叩けばオリジナルの man ページが、\n`jman` を叩くと日本語の man ページが表示できるようになります。\n\nめでたしめでたし。\n","slug":"japanese-man-page"},{"data":{"title":"JSON parser を書いた","published":"2022/05/27","tags":["Rust","nom"]},"content":"\nyak shaving で作っていた JSON parser が一応完成。  \nRust 楽しいすなあ。\n\nHaskell の parsec の感覚で使えるかと思って [nom](https://github.com/Geal/nom) を使ってみたけれど、最初はなかなかとっつきづらく。  \nまあだいたい慣れることができたのでよし！\n\nせっかくなので [crates.io](https://crates.io/) に公開したのだけれど、  \nhttps://doc.rust-jp.rs/book-ja/ch14-02-publishing-to-crates-io.html を見ながら `cargo publish` すると他の crate と比べて表示が足りない。  \n`Cargo.toml` に `respository` や `documentation` を追加する必要があったのね。\n\nhttps://crates.io/crates/wson\n\n名前は `wat-aro` の json parser で `wson` にした。  \nテストがめんどうでした。  \n[json.org](https://www.json.org/json-en.html)にはお世話になりました。\n\nさっさと movable type を変換するぞ！\n","slug":"wson"},{"data":{"title":"Playwright で OGP 画像を生成する","published":"2022/05/24","tags":["Next.js","TypeScript"]},"content":"\nブログ記事のインポートをしたかったはずなのに json parser を作る yak shaving が楽しい。  \n次は Scheme のインタプリタを作りたくなってきた。危ない。\n\nさて、表題のとおりブログの OGP 画像を [Playwright](https://github.com/microsoft/playwright) で生成するようにした。  \nこのサイトは [Next.js](https://nextjs.org/) で作って、[GitHub Pages](https://docs.github.com/ja/pages/getting-started-with-github-pages/about-github-pages) でホスティングしている。  \nソースコードは[ここ](https://github.com/wat-aro/wat-aro.github.io)にある。\n\nブログ記事のタイトルと slug から OGP 画像を生成している。\n\n```ts\nimport { chromium } from 'playwright';\nimport { getHtml } from './getHtml';\n\ntype Params = {\n  title: string;\n  slug: string;\n};\n\nexport const takeScreenshot = async ({ title, slug }: Params) =\u003e {\n  const browser = await chromium.launch();\n  const context = await browser.newContext({\n    viewport: { width: 1200, height: 630 },\n  });\n  const page = await context.newPage();\n  const html = getHtml({ title });\n  await page.setContent(html, { waitUntil: 'load' });\n  await page.screenshot({\n    path: `public/og-images/${slug}.png`,\n    fullPage: true,\n  });\n  await browser.close();\n};\n```\n\n`await page.setContent(html, { waitUntil: 'load' });` の `load` を指定するのが味噌。  \nまた、`setContent` に渡す html 内で画像を使う場合は[データ URL](https://developer.mozilla.org/ja/docs/Web/HTTP/Basics_of_HTTP/Data_URLs) に base64 エンコードされた画像を渡す必要がある。  \n`setContent` には文字列を渡しているだけなためファイルパスでは Playwright は画像を特定できない。  \n後は html と css を書いたら完成。  \nこれくらいの用途だと Playwright でも Puppeteer でも変わらないね。\n\nまだまだサイトに実装しないといけないことが盛り沢山なのでがんばるぞい\n","slug":"generate-ogimage-by-playwright"},{"data":{"title":"json で nom のお勉強","published":"2022/05/16","tags":["Rust","nom"]},"content":"\n旧ブログの `movable type` を `markdown` に変換したい。  \n[nom](https://github.com/Geal/nom) でパースしようと思ったが Readme を読んでもいまいちしっくりこない。  \nparsec と同じようにはできませんか。\nとりあえず練習がてら何かをパースしてみる。  \n仕様があるほうが嬉しいので探してみると [json](https://www.json.org/json-ja.html) がよさそうだった。  \nまずは `digits` を書いてみた。  \n[digit1](https://docs.rs/nom/latest/nom/character/complete/fn.digit1.html) を使えば終わりなのだが、それでは練習にならないため定義通りに実装。\n\nhttps://github.com/wat-aro/wjson\n\n```rust\nfn zero(input: \u0026str) -\u003e IResult\u003c\u0026str, u64\u003e {\n    map(char('0'), |c| c.to_string().parse::\u003cu64\u003e().unwrap())(input)\n}\n\nfn onenine(input: \u0026str) -\u003e IResult\u003c\u0026str, u64\u003e {\n    map(\n        alt((\n            char('1'),\n            char('2'),\n            char('3'),\n            char('4'),\n            char('5'),\n            char('6'),\n            char('7'),\n            char('8'),\n            char('9'),\n        )),\n        |c| c.to_string().parse::\u003cu64\u003e().unwrap(),\n    )(input)\n}\n\npub fn digit(input: \u0026str) -\u003e IResult\u003c\u0026str, u64\u003e {\n    alt((zero, onenine))(input)\n}\n\npub fn digits(input: \u0026str) -\u003e IResult\u003c\u0026str, u64\u003e {\n    let (rest, v) = many1(digit)(input)?;\n    let str_vec: String = v.iter().map(|d| d.to_string()).collect::\u003cString\u003e();\n\n    Ok((rest, str_vec.parse().unwrap()))\n}\n```\n\nまだ `Rust` を書き慣れていないけれど楽しい。\n","slug":"study-nom-by-json"},{"data":{"title":"ブログを移転しました","published":"2022/05/15"},"content":"\nhttps://wat-aro.hatenablog.com/ のブログを移転。\n`github.io` 用にドメインは前から取得していたが、やっとサイトを作成する気になった。\n今後はこちらに書いていくつもり。\n\n使用技術は\n\n- Next.js\n- TypeScript\n- Tailwind CSS\n- github.io\n\nNext.js の開発体験はいいね。  \nあまり難しいことはやらないつもりだけど、 `webassembly` まわりの何かを仕込んでみたい。  \n残作業は\n\n- 旧ブログのデータのインポート\n- OGP の設定\n- reveal.js で書いたスライドをこのサイトで表示できるようにする\n\n### 旧ブログのデータのインポート\n\nはてなブログは `Movable Type` でデータをエクスポートできる。  \nこれを `markdown` に変換して移行する予定。  \n`Rust` の練習にちょうどいいかなーと思ってる。\n\n### OGP の設定\n\n[puppeteer](https://github.com/puppeteer/puppeteer) を使う予定。  \n`next export` を叩く前に `markdown` のファイルごとにスクリーンショットを取ればいけるかと。  \n若干めんどくさくなっているが、最後まで頑張ろう。\n\n### reveal.js で書いたスライドをこのサイトで表示できるようにする\n\nプロフィールにリンクはあるけれど、これを `Next.js` で管理できるようにしたい。  \nしばらくは [About](https://wat-aro.dev/about) に書いたままにする。\n\n### 最後に\n\n数年まともにブログを書いてこなかったので今後はちゃんと書いていくつもり。  \nやるぞ！\n","slug":"moved-my-blog-to-github-io"},{"data":{"title":"RSPレジスタに対する勘違い","published":"2021/09/16"},"content":"\n\u003cp\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/RSP\"\u003eRSP\u003c/a\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%EC%A5%B8%A5%B9%A5%BF\"\u003eレジスタ\u003c/a\u003eとスタックについて勘違いしていた。\u003c/p\u003e\n\n\u003cp\u003eスタックが下に伸びていくという話から実際のデータも大きいアドレスから小さいアドレスへと順に入っているとイメージしてしまっていた。\u003cbr /\u003e\nこのような状態では\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/RSP\"\u003eRSP\u003c/a\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%EC%A5%B8%A5%B9%A5%BF\"\u003eレジスタ\u003c/a\u003eがスタックトップに入っているデータの先頭を指していると考えると、スタックトップよりも先にスタックトップが示すデータが入ってしまっている。\u003cbr /\u003e\n仮にこのスタックに更にpushした場合、\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/RSP\"\u003eRSP\u003c/a\u003eを進めるまえに、現在のスタックトップに入っているデータ分、\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/RSP\"\u003eRSP\u003c/a\u003eを進める必要が出てしまい、現在のデータの大きさをどこかに保持していないとだめになってしまう。\u003cbr /\u003e\nこの状態でスタックの計算を考えていたため混乱してしまった。\u003c/p\u003e\n\n\u003cp\u003e実際にはデータはアドレスの小さいほうから大きいほうに向かって入っている。\u003cbr /\u003e\nこの場合\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/RSP\"\u003eRSP\u003c/a\u003eが指すスタックトップはデータのある領域とデータのない領域の境目を指すことになる。\u003cbr /\u003e\n変数のデータ領域を確保するために、\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/RSP\"\u003eRSP\u003c/a\u003eを減算する時は変数のバイトサイズ分引くだけでよい。\u003c/p\u003e\n\n\u003cp\u003e\u003cspan itemscope itemtype=\"http://schema.org/Photograph\"\u003e\u003cimg src=\"https://cdn-ak.f.st-hatena.com/images/fotolife/w/wat-aro/20210916/20210916221321.png\" alt=\"f:id:wat-aro:20210916221321p:plain\" width=\"826\" height=\"583\" loading=\"lazy\" title=\"\" class=\"hatena-fotolife\" itemprop=\"image\"\u003e\u003c/span\u003e\u003c/p\u003e\n\n\u003cp\u003e低レイヤわからん\u003c/p\u003e\n\n","slug":"RSPレジスタに対する勘違い"},{"data":{"title":"container 内で wasm-pack test を実行すると bind() failed: Cannot assign requested address (99) になる","published":"2021/08/25"},"content":"\n\u003cp\u003ewasm-pack を使える Docker 環境を作成し、その中で\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%C1%A5%E5%A1%BC%A5%C8%A5%EA%A5%A2%A5%EB\"\u003eチュートリアル\u003c/a\u003eをしていたところ、タイトルのようなエラーが出て \u003ccode\u003ewasm-pack test\u003c/code\u003e が実行できなかった。\u003cbr /\u003e\nこのコンテナでは rust, wasm-pack, npm が使えるだけの状態で、コンテナ内に \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Chrome\"\u003eChrome\u003c/a\u003e がインストールされていないことが原因だった。\u003cbr /\u003e\nDockerfile に \u003ccode\u003egoogle-chrome-stable\u003c/code\u003e を追加すると無事実行できるようになりました。\u003c/p\u003e\n\n\u003cpre class=\"code lang-diff\" data-lang=\"diff\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e-RUN apt-get update -qq \\\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e- \u0026amp;\u0026amp; apt-get install -y libnss3\u003c/span\u003e\n\u003cspan class=\"synIdentifier\"\u003e+RUN wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add \\\u003c/span\u003e\n\u003cspan class=\"synIdentifier\"\u003e+  \u0026amp;\u0026amp; echo 'deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main' | tee /etc/apt/sources.list.d/google-chrome.list \\\u003c/span\u003e\n\u003cspan class=\"synIdentifier\"\u003e+  \u0026amp;\u0026amp; apt-get update -qq \\\u003c/span\u003e\n\u003cspan class=\"synIdentifier\"\u003e+  \u0026amp;\u0026amp; apt-get install -y google-chrome-stable libnss3 libgconf-2-4\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003echromedriver が \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ipv6\"\u003eipv6\u003c/a\u003e の subnet を探しているんじゃないかなどかなり回り道をしてしまった\u003c/p\u003e\n\n","slug":"container 内で wasm-pack test を実行すると bind() failed: Cannot assign requested address (99) になる"},{"data":{"title":"Chrome などで Emacs キーバインディングを使う","published":"2020/02/24"},"content":"\n\u003cp\u003e\u003ccode\u003e~/.config/gtk-3.0/settings.ini\u003c/code\u003e に追記する\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003e[Settings]\ngtk-key-theme-name = Emacs\u003c/pre\u003e\n\n\n\u003cp\u003e\u003ca href=\"https://askubuntu.com/questions/124815/how-do-i-enable-emacs-keybindings-in-apps-such-as-google-chrome/918962#918962\"\u003egtk - How do I enable Emacs keybindings in apps, such as Google Chrome? - Ask Ubuntu\u003c/a\u003e\u003c/p\u003e\n\n","slug":"Chrome などで Emacs キーバインディングを使う"},{"data":{"title":"emacs で fcitx-mozc を使う","published":"2020/02/23","tags":["Arch","mozc","emacs","fcitx"]},"content":"\n\u003cp\u003e今はこの記事のやり方のほうがよい\u003c/p\u003e\n\n\u003cp\u003e\u003ciframe src=\"https://hatenablog-parts.com/embed?url=https%3A%2F%2Fain0204.hatenablog.com%2Fentry%2F2016%2F08%2F12%2F235206\" title=\"Arch Linuxにemacs-mozcをインストールした話 - twitterよりちょっと長いの\" class=\"embed-card embed-blogcard\" scrolling=\"no\" frameborder=\"0\" style=\"display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;\"\u003e\u003c/iframe\u003e\u003ccite class=\"hatena-citation\"\u003e\u003ca href=\"https://ain0204.hatenablog.com/entry/2016/08/12/235206\"\u003eain0204.hatenablog.com\u003c/a\u003e\u003c/cite\u003e\u003c/p\u003e\n\n\u003chr /\u003e\n\n\u003cp\u003e以下は今だとうまく動かない\u003c/p\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e$ yay -G fcitx-mozc\u003c/pre\u003e\n\n\n\u003cp\u003e\u003ccode\u003ePKGBUILD\u003c/code\u003e を編集する。\u003c/p\u003e\n\n\u003cpre class=\"code lang-diff\" data-lang=\"diff\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e-  _targets=\u0026quot;server/server.gyp:mozc_server gui/gui.gyp:mozc_tool unix/fcitx/fcitx.gyp:fcitx-mozc\u0026quot;\u003c/span\u003e\n\u003cspan class=\"synIdentifier\"\u003e+  _targets=\u0026quot;server/server.gyp:mozc_server gui/gui.gyp:mozc_tool unix/fcitx/fcitx.gyp:fcitx-mozc unix/emacs/emacs.gyp:mozc_emacs_helper\u0026quot;\u003c/span\u003e\n\n   install -D -m 755 out_linux/${_bldtype}/mozc_server \u0026quot;${pkgdir}/usr/lib/mozc/mozc_server\u0026quot;\n   install    -m 755 out_linux/${_bldtype}/mozc_tool   \u0026quot;${pkgdir}/usr/lib/mozc/mozc_tool\u0026quot;\n\n\u003cspan class=\"synIdentifier\"\u003e+  install -D -m 755 out_linux/${_bldtype}/mozc_emacs_helper \u0026quot;${pkgdir}/usr/bin/mozc_emacs_helper\u0026quot;\u003c/span\u003e\n\u003cspan class=\"synIdentifier\"\u003e+\u003c/span\u003e\n   install -d \u0026quot;${pkgdir}/usr/share/licenses/$pkgname/\u0026quot;\n   install -m 644 LICENSE data/installer/*.html \u0026quot;${pkgdir}/usr/share/licenses/${pkgname}/\u0026quot;\n\u003c/pre\u003e\n\n\n\u003cp\u003e手動でインストール\u003c/p\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e$ cd fcitx-mozc\n$ makepkg -si\n\n# 不明な公開鍵についてのエラーがでる\n$ sudo pacman-key --recv-keys \u0026lt;keyid\u0026gt;\n$ gpg --recv-keys \u0026lt;keyid\u0026gt;\n\n$ makepkg -si\u003c/pre\u003e\n\n\n\u003cp\u003eこれで \u003ccode\u003e/usr/bin/mozc_emacs_helper\u003c/code\u003e が入る。\nあとは\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/emacs\"\u003eemacs\u003c/a\u003eの設定をする。\u003c/p\u003e\n\n\u003cpre class=\"code elisp\" data-lang=\"elisp\" data-unlink\u003e(use-package mozc\n  :init\n  (setq default-input-method \u0026#34;japanese-mozc\u0026#34;)\n  :custom\n  (mozc-candidate-style \u0026#39;overlay))\u003c/pre\u003e\n\n\n","slug":"emacs で fcitx-mozc を使う"},{"data":{"title":"X1 Carbon Gen 7th に Arch Linux をインストール","published":"2020/02/11","tags":["Arch"]},"content":"\n\u003cp\u003e基本的にはインストールガイドのとおり\n\u003ca href=\"https://wiki.archlinux.jp/index.php/\"\u003ehttps://wiki.archlinux.jp/index.php/\u003c/a\u003eインストールガイド\nWindowManager は \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/XMonad\"\u003eXMonad\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%C6%A5%A3%A5%B7%A5%E7%A5%F3\"\u003eパーティション\u003c/a\u003e\u003c/h2\u003e\n\n\u003cp\u003efuntoo を参考\n\u003ca href=\"https://www.funtoo.org/Install/GPT_Partitioning\"\u003ehttps://www.funtoo.org/Install/GPT_Partitioning\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003eフォーマット\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# mkfs.fat -F32 /dev/nvme0n1p1 # ESP\n# fatlabel /dev/nvme0n1p1 efi\n# mkfs.btrfs -L root /dev/nvme0n1p3 # Root\n# mkswap /dev/nvme0n1p2\n# swapon /dev/nvme0n1p2\u003c/pre\u003e\n\n\n\u003ch2\u003eマウント\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# mount /dev/nvme0n1p3 /mnt\n# mkdir /mnt/boot\n# mount /dev/nvme0n1p1 /mnt/boot\u003c/pre\u003e\n\n\n\u003ch2\u003eシステムクロックの更新\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# timedatectl set-ntp true\u003c/pre\u003e\n\n\n\u003ch2\u003eインストール\u003c/h2\u003e\n\n\u003cp\u003eJapanのミラーのみを使うように変更\u003c/p\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# vim /etc/pacman.d/mirrorlist\u003c/pre\u003e\n\n\n\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# pacstrap /mnt base linux linux-firmware\u003c/pre\u003e\n\n\n\u003ch2\u003eシステムの設定\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# genfstab -L /mnt \u0026gt;\u0026gt; /mnt/etc/fstab\n# cat /mnt/etc/fstab\u003c/pre\u003e\n\n\n\u003ch2\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/chroot\"\u003echroot\u003c/a\u003e\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# arch-chroot /mnt\u003c/pre\u003e\n\n\n\u003ch2\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%BF%A5%A4%A5%E0%A5%BE%A1%BC%A5%F3\"\u003eタイムゾーン\u003c/a\u003e\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n# hwclock --systohc --utc\u003c/pre\u003e\n\n\n\u003ch2\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%ED%A5%B1%A1%BC%A5%EB\"\u003eロケール\u003c/a\u003e\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# pacman -S neovim\n# nvim /etc/locale.gen\u003c/pre\u003e\n\n\n\u003cp\u003e\u003ccode\u003eja_JP.UTF-8 UTF-8\u003c/code\u003e と \u003ccode\u003een_US.UTF-8 UTF-8\u003c/code\u003e をアンコメント\u003c/p\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# locale-gen\n# echo LANG=en_US.UTF-8 \u0026gt; /etc/locale.conf\u003c/pre\u003e\n\n\n\u003ch2\u003eネットワーク\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# pacman -S networkmanager\n# systemctl enable NetworkManager.service\u003c/pre\u003e\n\n\n\u003ch2\u003eRootパスワード\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# passwd\u003c/pre\u003e\n\n\n\u003ch2\u003eブート\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# pacman -S efibootmgr\n# efibootmgr -d /dev/nvme0n1 -p 1 -c -L \u0026#34;Arch Linux\u0026#34; -l /vmlinuz-linux -u \u0026#34;root=/dev/nvme0n1p3 rw initrd=/initramfs-linux.img\u0026#34;\n# exit\n# reboot\u003c/pre\u003e\n\n\n\u003ch2\u003eユーザ追加\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# pass\n# useradd -m -g users -G wheel -s /bin/bash wat-aro\n# passwd wat-aro\n# groupadd wat-aro\n# gpasswd -a wat-aro wat-aro\nid wat-aro\u003c/pre\u003e\n\n\n\u003ch2\u003esudo\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e# pacman -S sudo\n# EDITOR=nvim visudo\u003c/pre\u003e\n\n\n\u003cp\u003e以下を追記\u003c/p\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e%wheel ALL=(ALL) ALL\u003c/pre\u003e\n\n\n\u003ch2\u003eYay\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e$ sudo pacman -S git\n$ sudo pacman -S base-devel\n$ git clone https://aur.archlinux.org/yay.git\n$ cd yay\n$ makepkg -si\u003c/pre\u003e\n\n\n\u003ch2\u003eman\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e$ yay -S man-db\n$ mandb\u003c/pre\u003e\n\n\n\u003ch2\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Xorg\"\u003eXorg\u003c/a\u003e\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e$ yay -S xorg-server\n$ lspci | grep -e VGA -e 3D\n$ yay -S xf86-video-intel\n$ yay -S xorg-xrdb rxvt-unicode xorg-xmodmap\u003c/pre\u003e\n\n\n\u003ch2\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/GUI\"\u003eGUI\u003c/a\u003e 準備\u003c/h2\u003e\n\n\u003cp\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/uim\"\u003euim\u003c/a\u003e の設定が終わるまで \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/xmonad\"\u003exmonad\u003c/a\u003e がちゃんと動かない\u003c/p\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e$ git clone https://github.com/wat-aro/dotfiles\n$ cd dotfiles\n$ ./install.sh\n$ yay -S xmonad xmonad-contrib dmenu xmobar\n$ xmonad --recompile\u003c/pre\u003e\n\n\n\u003ch2\u003e日本語入力\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e$ yay -S uim anthy gtk3\n$ uim-pref-gtk3\u003c/pre\u003e\n\n\n\u003ch2\u003eブラウザ\u003c/h2\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e$ yay -S noto-fonts noto-fonts-cjk noto-fonts-emoji\n$ yay -S google-chrome\u003c/pre\u003e\n\n\n\u003ch2\u003eフォント\u003c/h2\u003e\n\n\u003cp\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Ricty\"\u003eRicty\u003c/a\u003e を手動で入れる\u003c/p\u003e\n\n\u003ch2\u003eLightDM\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://wiki.archlinux.jp/index.php/LightDM\"\u003eLightDM - ArchWiki\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/Hayao0819/items/7784178c7fd568291905\"\u003e\u0026#x3010;ArchLinux\u0026#x3011;\u0026#x6700;\u0026#x9AD8;\u0026#x306E;\u0026#x30ED;\u0026#x30B0;\u0026#x30A4;\u0026#x30F3;\u0026#x753B;\u0026#x9762; - Qiita\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eを参考\u003c/p\u003e\n\n\u003ch2\u003eオーディオ\u003c/h2\u003e\n\n\u003cp\u003eオーディオを有効にするためには \u003ccode\u003esof-firmware\u003c/code\u003e も必要\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.reddit.com/r/archlinux/comments/e5rpxv/thinkpad_x1_carbon_gen_7_audio_broken_on_541arch11/\"\u003eThinkpad X1 Carbon Gen 7 audio broken on 5.4.1-arch1-1 : archlinux\u003c/a\u003e\u003c/p\u003e\n\n\u003cpre class=\"code shell\" data-lang=\"shell\" data-unlink\u003e$ yay -S alsa-utils sof-firmware pulseaudio pavucontrol\u003c/pre\u003e\n\n\n","slug":"X1 Carbon Gen 7th に Arch Linux をインストール"},{"data":{"title":"ActiveModel::Attributesでカスタムタイプを使う","published":"2018/08/07"},"content":"\n\u003cp\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Rails\"\u003eRails\u003c/a\u003e 5.2.0 で入ったActiveModel::Attributes \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/API\"\u003eAPI\u003c/a\u003e 最高ですよね。\u003c/p\u003e\n\n\u003cp\u003eでもカスタムタイプのドキュメントが見つからないんですよね。 \u003ca href=\"https://api.rubyonrails.org/classes/ActiveRecord/Attributes/ClassMethods.html#method-i-attribute\"\u003eActiveRecord::Attributes API のカスタムタイプ\u003c/a\u003e ならあるのですが。\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9\"\u003eソースコード\u003c/a\u003e見たところ簡単に作れるのがわかったので紹介します。\u003c/p\u003e\n\n\u003cp\u003eまず型の登録部分ですが、\u003ca href=\"https://github.com/rails/rails/blob/5-2-0/activemodel/lib/active_model/type.rb#L20-L53\"\u003elib/active_model/type.rb\u003c/a\u003e で定義されています。\u003c/p\u003e\n\n\u003cp\u003eまた、\u003ca href=\"https://github.com/rails/rails/blob/5-2-0/activemodel/lib/active_model/type/boolean.rb\"\u003eActiveModelで使われているデフォルトタイプの実装\u003c/a\u003eを見ると \u003ccode\u003ecast_value\u003c/code\u003e メソッドがあればよさそうです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://api.rubyonrails.org/classes/ActiveRecord/Attributes/ClassMethods.html#method-i-attribute\"\u003eActiveRecord::Attributes API\u003c/a\u003e と同様に実装します。\u003c/p\u003e\n\n\u003cpre class=\"code lang-ruby\" data-lang=\"ruby\" data-unlink\u003e\u003cspan class=\"synPreProc\"\u003eclass\u003c/span\u003e \u003cspan class=\"synType\"\u003eMoneyType\u003c/span\u003e \u0026lt; \u003cspan class=\"synType\"\u003eActiveModel\u003c/span\u003e::\u003cspan class=\"synType\"\u003eType\u003c/span\u003e::\u003cspan class=\"synType\"\u003eInteger\u003c/span\u003e\n  \u003cspan class=\"synPreProc\"\u003edef\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003ecast_value\u003c/span\u003e(value)\n    \u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e !value.kind_of?(\u003cspan class=\"synType\"\u003eNumeric\u003c/span\u003e) \u0026amp;\u0026amp; value.include?(\u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e$\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003e)\n      price_in_dollars = value.gsub(\u003cspan class=\"synSpecial\"\u003e/\\$/\u003c/span\u003e, \u003cspan class=\"synSpecial\"\u003e''\u003c/span\u003e).to_f\n      \u003cspan class=\"synStatement\"\u003esuper\u003c/span\u003e(price_in_dollars * \u003cspan class=\"synConstant\"\u003e100\u003c/span\u003e)\n    \u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e\n      \u003cspan class=\"synStatement\"\u003esuper\u003c/span\u003e\n    \u003cspan class=\"synStatement\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"synPreProc\"\u003eend\u003c/span\u003e\n\u003cspan class=\"synPreProc\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e# config/initializers/types.rb\u003c/span\u003e\n\u003cspan class=\"synType\"\u003eActiveModel\u003c/span\u003e::\u003cspan class=\"synType\"\u003eType\u003c/span\u003e.register(\u003cspan class=\"synConstant\"\u003e:money\u003c/span\u003e, \u003cspan class=\"synType\"\u003eMoneyType\u003c/span\u003e)\n\n\u003cspan class=\"synComment\"\u003e# app/models/store_listing.rb\u003c/span\u003e\n\u003cspan class=\"synPreProc\"\u003eclass\u003c/span\u003e \u003cspan class=\"synType\"\u003eStoreListing\u003c/span\u003e\n  \u003cspan class=\"synPreProc\"\u003einclude\u003c/span\u003e \u003cspan class=\"synType\"\u003eActiveModel\u003c/span\u003e::\u003cspan class=\"synType\"\u003eModel\u003c/span\u003e\n  \u003cspan class=\"synPreProc\"\u003einclude\u003c/span\u003e \u003cspan class=\"synType\"\u003eActiveModel\u003c/span\u003e::\u003cspan class=\"synType\"\u003eAttributes\u003c/span\u003e\n\n  attribute \u003cspan class=\"synConstant\"\u003e:price_in_cents\u003c/span\u003e, \u003cspan class=\"synConstant\"\u003e:money\u003c/span\u003e\n\u003cspan class=\"synPreProc\"\u003eend\u003c/span\u003e\n\nstore_listing = \u003cspan class=\"synType\"\u003eStoreListing\u003c/span\u003e.new(\u003cspan class=\"synConstant\"\u003eprice_in_cents\u003c/span\u003e: \u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e$10.00\u003c/span\u003e\u003cspan class=\"synSpecial\"\u003e'\u003c/span\u003e)\nstore_listing.price_in_cents \u003cspan class=\"synComment\"\u003e# =\u0026gt; 1000\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003eこのように ActiveModel::Attributes でカスタムタイプを使うことができます。\u003c/p\u003e\n\n","slug":"ActiveModel::Attributesでカスタムタイプを使う"},{"data":{"title":"http-conduit で取得したデータを日本語表示する","published":"2018/02/27","tags":["Haskell"]},"content":"\n\u003cp\u003e簡単な\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/cli\"\u003ecli\u003c/a\u003eツールを書こうとしたら http-conduit で取得したデータの日本語表示でハマってしまいました。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003ehttp-conduit\u003c/code\u003e の \u003ccode\u003ehttpLbs\u003c/code\u003e で取得したデータをそのままターミナルに出力します。\u003cbr/\u003e\n必要なパッケージは \u003ccode\u003ehttp-conduit\u003c/code\u003e \u003ccode\u003ebytestring\u003c/code\u003e \u003ccode\u003eutf8-string\u003c/code\u003e の３つ。\u003c/p\u003e\n\n\u003cpre class=\"code lang-haskell\" data-lang=\"haskell\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e{-# LANGUAGE OverloadedStrings #-}\u003c/span\u003e\n\n\u003cspan class=\"synPreProc\"\u003eimport\u003c/span\u003e \u003cspan class=\"synPreProc\"\u003equalified\u003c/span\u003e Codec.Binary.UTF8.String \u003cspan class=\"synPreProc\"\u003eas\u003c/span\u003e Codec\n\u003cspan class=\"synPreProc\"\u003eimport\u003c/span\u003e           Data.ByteString.Char8    (unpack)\n\u003cspan class=\"synPreProc\"\u003eimport\u003c/span\u003e           Data.ByteString.Lazy     (toStrict)\n\u003cspan class=\"synPreProc\"\u003eimport\u003c/span\u003e \u003cspan class=\"synPreProc\"\u003equalified\u003c/span\u003e Network.HTTP.Simple      \u003cspan class=\"synPreProc\"\u003eas\u003c/span\u003e Simple\n\nmain \u003cspan class=\"synStatement\"\u003e::\u003c/span\u003e IO ()\nmain \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e \u003cspan class=\"synStatement\"\u003edo\u003c/span\u003e\n    res \u003cspan class=\"synStatement\"\u003e\u0026lt;-\u003c/span\u003e Simple.httpLbs \u003cspan class=\"synConstant\"\u003e\u0026quot;https://twitter.com/\u0026quot;\u003c/span\u003e\n\n    putStrLn \u003cspan class=\"synStatement\"\u003e$\u003c/span\u003e Codec.decodeString \u003cspan class=\"synStatement\"\u003e$\u003c/span\u003e unpack \u003cspan class=\"synStatement\"\u003e$\u003c/span\u003e toStrict \u003cspan class=\"synStatement\"\u003e$\u003c/span\u003e Simple.getResponseBody res\n\u003c/pre\u003e\n\n\n\u003cp\u003e\u003ccode\u003ehttpLbs\u003c/code\u003e を使い取得したデータは \u003ccode\u003eReponse\u003c/code\u003e 型で包まれているので \u003ccode\u003egetResponseBody\u003c/code\u003e で \u003ccode\u003eByteString\u003c/code\u003e を取得し、 \u003ccode\u003eString\u003c/code\u003e に変換して出力します。\u003cbr/\u003e\nなぜか \u003ccode\u003eByteString\u003c/code\u003e でなく \u003ccode\u003eByteString.Lazy\u003c/code\u003e になっていたので \u003ccode\u003etoStrict\u003c/code\u003e で変換。\u003cbr/\u003e\nそして \u003ccode\u003eunpack\u003c/code\u003e しても日本語が表示されないため、 \u003ccode\u003eCodec.Binary.UTF8.String\u003c/code\u003e の \u003ccode\u003edecodeString\u003c/code\u003e で変換してから表示。\u003c/p\u003e\n\n\u003cp\u003e文字列難しい\u003c/p\u003e\n\n\u003cp\u003e[参考]\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/lotz/items/f8440fa08a62d1c44e1a\"\u003eHaskell\u0026#x304B;\u0026#x3089;\u0026#x7C21;\u0026#x5358;\u0026#x306B;Web API\u0026#x3092;\u0026#x53E9;\u0026#x304F;\u0026#x65B9;\u0026#x6CD5; - Qiita\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/satosystems/items/e07e9907e4da9ab853fc\"\u003eHaskell \u0026#x6587;\u0026#x5B57;\u0026#x5217;\u0026#x5909;\u0026#x63DB;\u0026#x5165;\u0026#x9580; - Qiita\u003c/a\u003e\u003c/p\u003e\n\n","slug":"http-conduit で取得したデータを日本語表示する"},{"data":{"title":"プログラミング Coq 証明駆動開発(1)","published":"2017/05/11"},"content":"\n\u003cp\u003e\u003ca href=\"http://www.iij-ii.co.jp/lab/techdoc/coqt/coqt8.html\"\u003e\u0026#x8A3C;\u0026#x660E;\u0026#x99C6;\u0026#x52D5;\u0026#x958B;\u0026#x767A;\u0026#x5165;\u0026#x9580;(1)\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e何かを読む会\u003c/code\u003e という社内勉強会が発足されました。\n読んだ本の内容を共有しよう。\n一人で勉強していてもダレるので共有することで無理やり進捗を出そう。\n他の人の発表を聞いて読んだ気になろう。\nっていう緩めの会です。\n途中まで読んで放置していたプログラミング Coq の続きを読んでまとめました。\u003c/p\u003e\n\n\u003ch1\u003e挿入ソートを証明する。\u003c/h1\u003e\n\n\u003cp\u003e証明したいことは次の二点。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e挿入前と挿入後で要素に変化がないこと(isort_permutation)\u003c/li\u003e\n\u003cli\u003e挿入後に要素が整列されていること(isort_sorted)\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003cp\u003e上記を型で示すと以下のようになる。\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eisort_permutation : forall (l : list nat), Permutation l (insertion_sort l)\nisort_sorted      : forall (l : list nat), LocallySorted le (insertion_sort l)\u003c/pre\u003e\n\n\n\u003ch2\u003e実装\u003c/h2\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eRequire Import List.\nRequire Import Arith.\n\nFixpoint insert (a : nat) (l : list nat) : list nat :=\n  match l with\n  | nil =\u0026gt; a :: nil\n  | x :: xs =\u0026gt; if leb a x then a :: l else x :: insert a xs\n  end.\n\nFixpoint insertion_sort (l : list nat) : list nat :=\n  match l with\n  | nil =\u0026gt; nil\n  | x :: xs =\u0026gt; insert x (insertion_sort xs)\n  end.\u003c/pre\u003e\n\n\n\u003ch2\u003e要素の変化がないこと\u003c/h2\u003e\n\n\u003cp\u003eあるリストがあるリストと同じ要素で成り立っているのは以下のモジュールで定義されている。\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eInductive Permutation : list A -\u0026gt; list A -\u0026gt; Prop :=\n  | perm_nil: Permutation [] []\n  | perm_skip x l l\u0026#39; : Permutation l l\u0026#39; -\u0026gt; Permutation (x::l) (x::l\u0026#39;)\n  | perm_swap x y l : Permutation (y::x::l) (x::y::l)\n  | perm_trans l l\u0026#39; l\u0026#39;\u0026#39; : Permutation l l\u0026#39; -\u0026gt; Permutation l\u0026#39; l\u0026#39;\u0026#39; -\u0026gt; Permutation l l\u0026#39;\u0026#39;.\u003c/pre\u003e\n\n\n\u003col\u003e\n\u003cli\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e と \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e は同じ要素から成り立つ\u003c/li\u003e\n\u003cli\u003el と l' が同じ要素から成り立つならば x :: l と x :: l' も同じ要素から成り立つ\u003c/li\u003e\n\u003cli\u003ey :: x :: l と x :: y :: l は同じ要素から成り立つ\u003c/li\u003e\n\u003cli\u003e(l と l' が同じ要素から成り立ち、l' と l'\u0026lsquo; が同じ要素から成り立つ) ならば l と l\u0026rsquo;\u0026lsquo; も同じ要素から成り立つ\u003c/li\u003e\n\u003c/ol\u003e\n\n\n\u003ch2\u003eisort_permutation の証明\u003c/h2\u003e\n\n\u003cp\u003eisort_permutation の型\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eforall (l : list nat), Permutation l (insertion_sort l)\u003c/pre\u003e\n\n\n\u003cp\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%B5%A2%C7%BC%CB%A1\"\u003e帰納法\u003c/a\u003eを使う。\nl が \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e の時は insertion_sort l は \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e なので\nPermutation \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e となり自明。\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%B5%A2%C7%BC%CB%A1\"\u003e帰納法\u003c/a\u003eのため、nの場合にあたる仮定は\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eforall (l : list nat), Permutation xs (insertion_sort xs)\u003c/pre\u003e\n\n\n\u003cp\u003en + 1 に当たる命題は\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eforall (l : list nat), Permutation x :: xs (insertion_sort x::xs)\u003c/pre\u003e\n\n\n\u003cp\u003eとなり、\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eforall (l : list nat), Permutation x :: xs (insert x (insertion_sort xs)\u003c/pre\u003e\n\n\n\u003cp\u003eと変形できる。\u003c/p\u003e\n\n\u003cp\u003eつまり\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eforall (l : list nat), Permuation x :: xs (x :: insertion_sort xs)\u003c/pre\u003e\n\n\n\u003cp\u003eと\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eforall (l : lsit nat), Permutation (x :: insertion_sort xs) (insert x (insertion_sort xs)\u003c/pre\u003e\n\n\n\u003cp\u003eを示すことで perm_trans から\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eforall l l\u0026#39; l\u0026#39;\u0026#39; , Permutation l l\u0026#39; -\u0026gt; Permutation l\u0026#39; l\u0026#39;\u0026#39; -\u0026gt; Permutation l l\u0026#39;\u0026#39;\u003c/pre\u003e\n\n\n\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003ePermutation (x :: xs) (x :: insertion_sort xs) -\u0026gt;\n  Permutation (x :: insertion_sort xs) (insert x (insertion_sort xs)) -\u0026gt;\n    Permutation (x :: xs) (insert x (insertion_sort xs))\u003c/pre\u003e\n\n\n\u003cp\u003eとなり、導ける。\u003c/p\u003e\n\n\u003cp\u003eA  については 仮定と Permutation のコンストラクタ\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eperm_skip : forall x l l\u0026#39;, Permutation l l\u0026#39; -\u0026gt; Permutation (x :: l) (x :: l\u0026#39;)\u003c/pre\u003e\n\n\n\u003cp\u003eから導ける。\u003c/p\u003e\n\n\u003cp\u003eまず B を\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%CA%E4%C2%EA\"\u003e補題\u003c/a\u003eとして証明する。\u003c/p\u003e\n\n\u003cp\u003eisort_permutaiton の証明は以下。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e 命令 \u003c/th\u003e\n\u003cth\u003e 説明 \u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e intros \u003c/td\u003e\n\u003ctd\u003e forall などから変数を仮定へ移動する \u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e simpl \u003c/td\u003e\n\u003ctd\u003e 簡約 \u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e apply \u003c/td\u003e\n\u003ctd\u003e 仮定や定理などを適用 \u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e destruct \u003c/td\u003e\n\u003ctd\u003e 条件分岐しているものなどを subgoal に分ける \u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e induction \u003c/td\u003e\n\u003ctd\u003e \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%B5%A2%C7%BC%CB%A1\"\u003e帰納法\u003c/a\u003eを実施するために subgoal に分ける \u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\n\u003cp\u003eどういうふうに証明が進むかは coq \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ide\"\u003eide\u003c/a\u003e や proof-general 使って見てください。\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eRequire Import List.\nRequire Import Arith.\nRequire Import Sorting.Permutation.\nRequire Import Sorting.Sorted.\n\n(* isort_permutation *)\n\nLemma insert_perm : forall (x : nat)(l : list nat), Permutation (x :: l) (insert x l).\n  induction l.\n  intros.\n  simpl.\n  apply Permutation_refl.\n\n  intros.\n  simpl.\n  destruct (leb x a).\n\n  apply Permutation_refl.\n\n  apply perm_trans with (a :: x :: l).\n  apply perm_swap.\n\n  apply perm_skip.\n  apply IHl.\nQed.\n\nTheorem isort_permutation : forall (l : list nat), Permutation l (insertion_sort l).\n  induction l.\n  apply perm_nil.\n  simpl.\n  apply perm_trans with (a :: insertion_sort l).\n  apply perm_skip.\n  apply IHl.\n  apply insert_perm.\nQed.\u003c/pre\u003e\n\n\n\u003ch2\u003e整列の定義\u003c/h2\u003e\n\n\u003cp\u003eリスト l が整列されていることはSorting.Sortedモジュールで定義されている.\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eInduction LocallySorted (A : Type) (R : A -\u0026gt; A -\u0026gt; Prop) : list A :=\n  | LSorted_nil : LocallySorted R nil\n  | LSorted_cons1 : forall a : A, LocallySorted R (a :: nil)\n  | LSorted_consn : forall (a b : A) (l : list A),\n    LocallySorted R (b :: l) -\u0026gt;\n      R a b -\u0026gt; LocallySorted R (a :: b :: l)\u003c/pre\u003e\n\n\n\u003cp\u003e上の定義は次のような意味です。\nR a b は a \u0026lt; b のようなものです。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e は整列している\u003c/li\u003e\n\u003cli\u003ex :: \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e は整列している\u003c/li\u003e\n\u003cli\u003eb :: l が整列しているとき, R a b ならば a :: b :: l は整列している\u003c/li\u003e\n\u003c/ol\u003e\n\n\n\u003ch2\u003e整列されていることの証明\u003c/h2\u003e\n\n\u003cp\u003eこちらでも\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%B5%A2%C7%BC%CB%A1\"\u003e帰納法\u003c/a\u003eで考える。\nまず l が \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e の場合は insertion_sort \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e = \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e となり、LSorted_\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e : LocallySorted le \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/nil\"\u003enil\u003c/a\u003e から明らか。\u003c/p\u003e\n\n\u003cp\u003eLocallySort le (insertion_sort l) -\u003e LocallySort le (insertion_sort (a :: l)) の場合を考える。\nLocallySort le (insertion_sort (a ::l) は LocallySort le (insert a (insertion_sort l))と変形できる。\nこの時、insertion_sort l は仮定より整列しているため、\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003einsert_sorted : forall (a : nat) (l : list a), LocallySort le l -\u0026gt; LocallySorted le (insert a l)\u003c/pre\u003e\n\n\n\u003cp\u003eを示すことができれば証明できる。\u003c/p\u003e\n\n\u003cp\u003eこれを\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%CA%E4%C2%EA\"\u003e補題\u003c/a\u003eとして証明をすすめる。\u003c/p\u003e\n\n\u003ch2\u003e整列の証明\u003c/h2\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eLemma insert_sorted : forall (a : nat) (l : list nat),\n    LocallySorted le l -\u0026gt; LocallySorted le (insert a l).\n  induction l.\n  constructor.\n\n  intro.\n  simpl.\n  remember (leb a a0).\n  destruct b.\n\n  apply LSorted_consn.\n  apply H.\n  apply leb_complete.\n  congruence.\n\n  inversion H.\n  simpl.\n  apply LSorted_consn.\n  apply LSorted_cons1.\n  apply lt_le_weak.\n  apply leb_complete_conv.\n  congruence.\n\n  subst.\n  simpl.\n  simpl in IHl.\n  remember (leb a b).\n\n  destruct b0.\n  apply LSorted_consn.\n  apply IHl.\n  apply H2.\n\n  apply lt_le_weak.\n  apply leb_complete_conv.\n  congruence.\n\n  apply LSorted_consn.\n  apply IHl.\n  apply H2.\n  apply H3.\nQed.\u003c/pre\u003e\n\n\n\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eTheorem isort_sorted : forall (l : list nat) , LocallySorted le (insertion_sort l).\n  induction l.\n  constructor.\n\n  simpl.\n\n  apply insert_sorted.\n  apply IHl.\nQed.\u003c/pre\u003e\n\n\n\u003cp\u003eこれで isertion_sort はソートの前後で要素が変わらないことと、ソート後に整列されていることが証明できた。\u003c/p\u003e\n\n","slug":"プログラミング Coq 証明駆動開発(1)"},{"data":{"title":"プログラミング Coq (証明駆動開発 2)","published":"2017/05/11"},"content":"\n\u003cp\u003e\u003ca href=\"http://www.iij-ii.co.jp/lab/techdoc/coqt/coqt9.html\"\u003e\u0026#x8A3C;\u0026#x660E;\u0026#x99C6;\u0026#x52D5;\u0026#x958B;\u0026#x767A;\u0026#x5165;\u0026#x9580;(2)\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e上記ページの勉強メモです。\u003c/p\u003e\n\n\u003ch1\u003eExtraction\u003c/h1\u003e\n\n\u003cp\u003ecoq から \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/OCaml\"\u003eOCaml\u003c/a\u003e, \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Haskell\"\u003eHaskell\u003c/a\u003e, \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Scheme\"\u003eScheme\u003c/a\u003e のコードを出力する。\u003cbr\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/OCaml\"\u003eOCaml\u003c/a\u003e にコードを出力するにはそのまま\u003cbr\u003e\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eExtraction map.\u003c/pre\u003e\n\n\n\u003cp\u003eとすればいい。\u003cbr\u003e\nこれで\u003c/p\u003e\n\n\u003cpre class=\"code lang-ocaml\" data-lang=\"ocaml\" data-unlink\u003e\u003cspan class=\"synComment\"\u003e(** val map : ('a1 -\u0026gt; 'a2) -\u0026gt; 'a1 list -\u0026gt; 'a2 list **)\u003c/span\u003e\n\n\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synStatement\"\u003erec\u003c/span\u003e map f \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e \u003cspan class=\"synStatement\"\u003efunction\u003c/span\u003e\n\u003cspan class=\"synStatement\"\u003e|\u003c/span\u003e \u003cspan class=\"synConstant\"\u003eNil\u003c/span\u003e \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"synConstant\"\u003eNil\u003c/span\u003e\n\u003cspan class=\"synStatement\"\u003e|\u003c/span\u003e \u003cspan class=\"synConstant\"\u003eCons\u003c/span\u003e \u003cspan class=\"synStatement\"\u003e(\u003c/span\u003ea, t\u003cspan class=\"synStatement\"\u003e)\u003c/span\u003e \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"synConstant\"\u003eCons\u003c/span\u003e \u003cspan class=\"synStatement\"\u003e((\u003c/span\u003ef a\u003cspan class=\"synStatement\"\u003e)\u003c/span\u003e, \u003cspan class=\"synStatement\"\u003e(\u003c/span\u003emap f t\u003cspan class=\"synStatement\"\u003e))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003eと出力される。（proof-general を使っています。coq-\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ide\"\u003eide\u003c/a\u003eの場合はcommand pane で実行）\u003cbr\u003e\u003c/p\u003e\n\n\u003cp\u003eこの時、list が \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/OCaml\"\u003eOCaml\u003c/a\u003e 組み込みのリストでなく coq で定義された list になっている。\u003cbr\u003e\n\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/OCaml\"\u003eOCaml\u003c/a\u003e 組み込みのリストを使うには\u003cbr\u003e\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eExtract Inductive list =\u0026gt; \u0026#34;list\u0026#34; [\u0026#34;[]\u0026#34; \u0026#34;(::)\u0026#34;].\u003c/pre\u003e\n\n\n\u003cp\u003eを実行する。こうすると\u003cbr\u003e\u003c/p\u003e\n\n\u003cpre class=\"code lang-ocaml\" data-lang=\"ocaml\" data-unlink\u003e\u003cspan class=\"synComment\"\u003e(** val map : ('a1 -\u0026gt; 'a2) -\u0026gt; 'a1 list -\u0026gt; 'a2 list **)\u003c/span\u003e\n\n\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synStatement\"\u003erec\u003c/span\u003e map f \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e \u003cspan class=\"synStatement\"\u003efunction\u003c/span\u003e\n\u003cspan class=\"synStatement\"\u003e|\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e[]\u003c/span\u003e \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"synStatement\"\u003e|\u003c/span\u003e a\u003cspan class=\"synStatement\"\u003e::\u003c/span\u003et \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"synStatement\"\u003e(\u003c/span\u003ef a\u003cspan class=\"synStatement\"\u003e)::(\u003c/span\u003emap f t\u003cspan class=\"synStatement\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003eと\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/OCaml\"\u003eOCaml\u003c/a\u003e 組み込みのリストを使ったmap関数が生成される。\u003cbr\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Haskell\"\u003eHaskell\u003c/a\u003e  や \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Scheme\"\u003eScheme\u003c/a\u003e に出力するにはそれぞれ\u003cbr\u003e\n\u003ccode\u003eExtraction Language Haskell.\u003c/code\u003e \u003ccode\u003eExtraction Language Scheme.\u003c/code\u003e としてから\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/OCaml\"\u003eOCaml\u003c/a\u003eの場合と同じように出力する。\u003cbr\u003e\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eExtraction Language Haskell.\nExtract Inductive list =\u0026gt; \u0026#34;list\u0026#34; [\u0026#34;[]\u0026#34; \u0026#34;(::)\u0026#34;].\nExtraction map.\u003c/pre\u003e\n\n\n\n\n\u003cpre class=\"code lang-haskell\" data-lang=\"haskell\" data-unlink\u003emap \u003cspan class=\"synStatement\"\u003e::\u003c/span\u003e (a1 \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e a2) \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e (list a1) \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e list a2\nmap f l \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e\n  \u003cspan class=\"synStatement\"\u003ecase\u003c/span\u003e l \u003cspan class=\"synStatement\"\u003eof\u003c/span\u003e {\n   [] \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e [];\n   (\u003cspan class=\"synStatement\"\u003e::\u003c/span\u003e) a t \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e (\u003cspan class=\"synStatement\"\u003e::\u003c/span\u003e) (f a) (map f t)}\n\u003c/pre\u003e\n\n\n\u003cp\u003e正しいけど、あまり綺麗なコードじゃない。\u003cbr\u003e\u003c/p\u003e\n\n\u003cpre class=\"code lang-haskell\" data-lang=\"haskell\" data-unlink\u003emap \u003cspan class=\"synStatement\"\u003e::\u003c/span\u003e (a \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e b) \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e (list a) \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e list b\nmap f [] \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e []\nmap f x\u003cspan class=\"synStatement\"\u003e::\u003c/span\u003exs \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e (f x) \u003cspan class=\"synStatement\"\u003e::\u003c/span\u003e (map f xs)\n\u003c/pre\u003e\n\n\n\u003cp\u003eくらいには変換してほしいけど、元の形からすると厳しいのかな。\u003cbr\u003e\u003c/p\u003e\n\n\u003cp\u003e次は \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/scheme\"\u003escheme\u003c/a\u003e.\u003cbr\u003e\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eExtraction Language Scheme.\nExtraction map.\u003c/pre\u003e\n\n\n\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e \u003cspan class=\"synIdentifier\"\u003emap\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003elambdas \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ef l\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ematch l\n     \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eNil\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e`(\u003c/span\u003eNil\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eCons\u003c/span\u003e a t\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e`(\u003c/span\u003eCons \u003cspan class=\"synSpecial\"\u003e,(\u003c/span\u003ef a\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e,(\u003c/span\u003e@ \u003cspan class=\"synIdentifier\"\u003emap\u003c/span\u003e f t\u003cspan class=\"synSpecial\"\u003e))))))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003eおお。lambdas ってなんだ。match なんて RnRSにないぞ。というか、準クオート使ってるし、\u003ccode\u003e,\u003c/code\u003e使った式展開も入ってる。\u003cbr\u003e\nCoq Extension \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Scheme\"\u003eScheme\u003c/a\u003e っていうのがあって、lambdas マクロやmatch マクロ、@マクロが定義されているわけか。\u003cbr\u003e\nlambdas マクロと @マクロはなかなかよい。\u003cbr\u003e\n\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/OCaml\"\u003eOCaml\u003c/a\u003e や \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Haskell\"\u003eHaskell\u003c/a\u003e っぽく書きたい時は便利そう。\u003cbr\u003e\nmatch マクロは define-syntax みたいな感じかな？\u003cbr\u003e\n直接変換するならたしかにこういうマクロ欲しくなるな。\u003cbr\u003e\u003c/p\u003e\n\n\u003ch2\u003einsertion_sort の変換\u003c/h2\u003e\n\n\u003ch3\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/OCaml\"\u003eOCaml\u003c/a\u003eの場合\u003c/h3\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eExtraction Language Ocaml.\n\nExtract Inductive list =\u0026gt; \u0026#34;list\u0026#34; [\u0026#34;[]\u0026#34; \u0026#34;(::)\u0026#34;].\nExtract Inductive bool =\u0026gt; \u0026#34;bool\u0026#34; [\u0026#34;true\u0026#34; \u0026#34;false\u0026#34;].\nExtract Inductive nat =\u0026gt; int [\u0026#34;0\u0026#34; \u0026#34;succ\u0026#34;] \u0026#34;(fun fO fS n -\u0026gt; if n = 0 then f O () else fS (n-1))\u0026#34;.\nExtraction insert.\nExtraction insertion_sort.\u003c/pre\u003e\n\n\n\n\n\u003cpre class=\"code lang-ocaml\" data-lang=\"ocaml\" data-unlink\u003e\u003cspan class=\"synComment\"\u003e(** val insert : int -\u0026gt; int list -\u0026gt; int list **)\u003c/span\u003e\n\n\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synStatement\"\u003erec\u003c/span\u003e insert a l \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e \u003cspan class=\"synStatement\"\u003ematch\u003c/span\u003e l \u003cspan class=\"synStatement\"\u003ewith\u003c/span\u003e\n\u003cspan class=\"synStatement\"\u003e|\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e[]\u003c/span\u003e \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e a\u003cspan class=\"synStatement\"\u003e::\u003c/span\u003e\u003cspan class=\"synConstant\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"synStatement\"\u003e|\u003c/span\u003e x\u003cspan class=\"synStatement\"\u003e::\u003c/span\u003exs \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"synStatement\"\u003eif\u003c/span\u003e \u003cspan class=\"synPreProc\"\u003eNat\u003c/span\u003e.leb a x \u003cspan class=\"synStatement\"\u003ethen\u003c/span\u003e a\u003cspan class=\"synStatement\"\u003e::\u003c/span\u003el \u003cspan class=\"synStatement\"\u003eelse\u003c/span\u003e x\u003cspan class=\"synStatement\"\u003e::(\u003c/span\u003einsert a xs\u003cspan class=\"synStatement\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"synComment\"\u003e(** val insertion_sort : int list -\u0026gt; int list **)\u003c/span\u003e\n\n\u003cspan class=\"synStatement\"\u003elet\u003c/span\u003e \u003cspan class=\"synStatement\"\u003erec\u003c/span\u003e insertion_sort \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e \u003cspan class=\"synStatement\"\u003efunction\u003c/span\u003e\n\u003cspan class=\"synStatement\"\u003e|\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e[]\u003c/span\u003e \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"synStatement\"\u003e|\u003c/span\u003e x\u003cspan class=\"synStatement\"\u003e::\u003c/span\u003exs \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e insert x \u003cspan class=\"synStatement\"\u003e(\u003c/span\u003einsertion_sort xs\u003cspan class=\"synStatement\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003ch3\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Haskell\"\u003eHaskell\u003c/a\u003eの場合\u003c/h3\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eExtraction Language Haskell.\n\nExtract Inductive list =\u0026gt; \u0026#34;([])\u0026#34; [\u0026#34;[]\u0026#34; \u0026#34;(:)\u0026#34;].\nExtract Inductive bool =\u0026gt; \u0026#34;Bool\u0026#34; [\u0026#34;True\u0026#34; \u0026#34;False\u0026#34;].\nExtract Inductive nat =\u0026gt; Int [\u0026#34;0\u0026#34; \u0026#34;succ\u0026#34;] \u0026#34;(\\fO fS n -\u0026gt; if n == 0 then fO () else fS (n-1))\u0026#34;.\u003c/pre\u003e\n\n\n\n\n\u003cpre class=\"code lang-haskell\" data-lang=\"haskell\" data-unlink\u003einsert \u003cspan class=\"synStatement\"\u003e::\u003c/span\u003e Int \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e (([]) Int) \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e ([]) Int\ninsert a l \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e\n  \u003cspan class=\"synStatement\"\u003ecase\u003c/span\u003e l \u003cspan class=\"synStatement\"\u003eof\u003c/span\u003e {\n   [] \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e (\u003cspan class=\"synStatement\"\u003e:\u003c/span\u003e) a [];\n   (\u003cspan class=\"synStatement\"\u003e:\u003c/span\u003e) x xs \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"synStatement\"\u003ecase\u003c/span\u003e leb a x \u003cspan class=\"synStatement\"\u003eof\u003c/span\u003e {\n     True \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e (\u003cspan class=\"synStatement\"\u003e:\u003c/span\u003e) a l;\n     False \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e (\u003cspan class=\"synStatement\"\u003e:\u003c/span\u003e) x (insert a xs)}}\n\ninsertion_sort \u003cspan class=\"synStatement\"\u003e::\u003c/span\u003e (([]) Int) \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e ([]) Int\ninsertion_sort l \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e\n  \u003cspan class=\"synStatement\"\u003ecase\u003c/span\u003e l \u003cspan class=\"synStatement\"\u003eof\u003c/span\u003e {\n   [] \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e [];\n   (\u003cspan class=\"synStatement\"\u003e:\u003c/span\u003e) x xs \u003cspan class=\"synStatement\"\u003e-\u0026gt;\u003c/span\u003e insert x (insertion_sort xs)}\n\u003c/pre\u003e\n\n\n\u003ch2\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Scheme\"\u003eScheme\u003c/a\u003eの場合\u003c/h2\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eExtraction Language Scheme.\n\nExtraction insert.\nExtraction insertion_sort.\u003c/pre\u003e\n\n\n\n\n\u003cpre class=\"code lang-scheme\" data-lang=\"scheme\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e insert \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003elambdas \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ea l\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ematch l\n     \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eNil\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e`(\u003c/span\u003eCons \u003cspan class=\"synSpecial\"\u003e,\u003c/span\u003ea \u003cspan class=\"synSpecial\"\u003e,`(\u003c/span\u003eNil\u003cspan class=\"synSpecial\"\u003e)))\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eCons\u003c/span\u003e x xs\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n       \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ematch \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e@ leb a x\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eTrue\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e`(\u003c/span\u003eCons \u003cspan class=\"synSpecial\"\u003e,\u003c/span\u003ea \u003cspan class=\"synSpecial\"\u003e,\u003c/span\u003el\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n          \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eFalse\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e`(\u003c/span\u003eCons \u003cspan class=\"synSpecial\"\u003e,\u003c/span\u003ex \u003cspan class=\"synSpecial\"\u003e,(\u003c/span\u003e@ insert a xs\u003cspan class=\"synSpecial\"\u003e))))))))\u003c/span\u003e\n\n\u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003edefine\u003c/span\u003e insertion_sort \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e\u003cspan class=\"synStatement\"\u003elambda\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003el\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003ematch l\n     \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003eNil\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e`(\u003c/span\u003eNil\u003cspan class=\"synSpecial\"\u003e))\u003c/span\u003e\n     \u003cspan class=\"synSpecial\"\u003e((\u003c/span\u003e\u003cspan class=\"synIdentifier\"\u003eCons\u003c/span\u003e x xs\u003cspan class=\"synSpecial\"\u003e)\u003c/span\u003e \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003e@ insert x \u003cspan class=\"synSpecial\"\u003e(\u003c/span\u003einsertion_sort xs\u003cspan class=\"synSpecial\"\u003e))))))\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003ch2\u003eファイルへの出力\u003c/h2\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003eExtraction Language Ocaml.\nExtraction \u0026#34;insertion_sort.ml\u0026#34; insertion_sort.\u003c/pre\u003e\n\n\n\u003cp\u003eと入力して proof-general で C-c C-n すると以下のようなファイルが生成された。\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003emodule Nat =\n struct\n  (** val leb : Int -\u0026gt; Int -\u0026gt; Bool **)\n\n  let rec leb n m =\n    (\\fO fS n -\u0026gt; if n == 0 then fO () else fS (n-1))\n      (fun _ -\u0026gt;\n      True)\n      (fun n\u0026#39; -\u0026gt;\n      (\\fO fS n -\u0026gt; if n == 0 then fO () else fS (n-1))\n        (fun _ -\u0026gt;\n        False)\n        (fun m\u0026#39; -\u0026gt;\n        leb n\u0026#39; m\u0026#39;)\n        m)\n      n\n end\n\n(** val insert : Int -\u0026gt; Int ([]) -\u0026gt; Int ([]) **)\n\nlet rec insert a l = match l with\n| [] -\u0026gt; a:[]\n| x:xs -\u0026gt;\n  (match Nat.leb a x with\n   | True -\u0026gt; a:l\n   | False -\u0026gt; x:(insert a xs))\n\n(** val insertion_sort : Int ([]) -\u0026gt; Int ([]) **)\n\nlet rec insertion_sort = function\n| [] -\u0026gt; []\n| x:xs -\u0026gt; insert x (insertion_sort xs)\u003c/pre\u003e\n\n\n\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003emodule Nat :\n sig\n  val leb : Int -\u0026gt; Int -\u0026gt; Bool\n end\n\nval insert : Int -\u0026gt; Int ([]) -\u0026gt; Int ([])\n\nval insertion_sort : Int ([]) -\u0026gt; Int ([])\u003c/pre\u003e\n\n\n\u003cp\u003elebも作ってくれるのか。\nまあないとコードにならないもんな。\u003c/p\u003e\n\n\u003ch2\u003e証明駆動開発のステップ\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eまず書こうとしているプログラムがどういう性質をみたすべきかを記述し、\u003c/li\u003e\n\u003cli\u003eCoq でそれをみたすようなプログラムを書き、\u003c/li\u003e\n\u003cli\u003e実際に最初に考えた性質を証明し、\u003c/li\u003e\n\u003cli\u003eExtraction して他の言語のコードに変換する\u003c/li\u003e\n\u003c/ol\u003e\n\n\n\u003ch2\u003e感想\u003c/h2\u003e\n\n\u003cp\u003e形式証明が慣れてないからなのかとても難しかった。\u003cbr\u003e\nただ、証明のステップを追うのはとても気持ちよかった。\u003cbr\u003e\u003c/p\u003e\n\n\u003cp\u003e次は、最近発売された純粋関数型データ構造読むかなって気分。\u003cbr\u003e\nSML で書かれているらしいから、\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/OCaml\"\u003eOCaml\u003c/a\u003e に置き換えながら写経するのが楽かな？\u003cbr\u003e\nそれとも付録に \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Haskell\"\u003eHaskell\u003c/a\u003e 実装があるらしいので \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Haskell\"\u003eHaskell\u003c/a\u003e に置き換えながら写経して、書けたら答え合わせするほうがいいかな。\u003cbr\u003e\n悩ましい。\u003c/p\u003e\n\n","slug":"プログラミング Coq (証明駆動開発 2)"},{"data":{"title":"技術書典2に行ってきた","published":"2017/04/09"},"content":"\n\u003cp\u003eお昼頃に予定があったので行くか迷っていたが、14時くらいには空いてきたということで技術書典2に行ってきた。\u003c/p\u003e\n\n\u003cp\u003e目当ての一つだったインターネットの闇さんの\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%E9\"\u003eコンパイラ\u003c/a\u003eの本は既に完売と向かってる最中の電車の中で知る。\nCoqに興味があったのでCoqによる定理証明が買えるといいなと思いながら突入。\u003c/p\u003e\n\n\u003cp\u003e16時過ぎでもう終わりかけなのになかなか賑わっていた。\n案の定、既に完売で何も片付けられているスペースもチラホラと。\nCoqによる定理証明のスペースを見つけたので、中身を見させてもらいながらCoqについて色々と教えていただいた。\n入門書かと思っていたけど違った。\n３部出ているうちの、一番簡単そうな2014年出版のものを買った。\nまずは入門して、そして読まねば。\u003c/p\u003e\n\n\u003cp\u003eその後ぶらぶらしていたら、インターネットの闇さんのスペースを見つけたので、見本を見させてもらいながら色々話した。\n見本に載っている\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/OCaml\"\u003eOCaml\u003c/a\u003eのコードはとても読みやすかったので、\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%C5%C5%BB%D2%BD%F1%C0%D2\"\u003e電子書籍\u003c/a\u003e版を期待していると伝え、またフラフラと。\u003c/p\u003e\n\n\u003cp\u003e移動してすぐに\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Fortran\"\u003eFortran\u003c/a\u003eで\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%AA%A5%D6%A5%B8%A5%A7%A5%AF%A5%C8%BB%D8%B8%FE\"\u003eオブジェクト指向\u003c/a\u003eプログラミングをするという尖ったことをしているところで声をかけられて \u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Fortran\"\u003eFortran\u003c/a\u003e の話を聞いた。\n\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Fortran\"\u003eFortran\u003c/a\u003e については、科学技術計算で主に使用されていることと、現在使われている\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%D7%A5%ED%A5%B0%A5%E9%A5%DF%A5%F3%A5%B0%B8%C0%B8%EC\"\u003eプログラミング言語\u003c/a\u003eの中で最も古い言語の一つってことくらいしか知らなかったのでおもしろかった。\n結局バグを減らしたかったり、大学みたいに人が入れ替わる環境だと既存のコードがすぐにレガシーになるので、可読性を高めたいということだった。\n\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Fortran\"\u003eFortran\u003c/a\u003e自体に\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%A5%AA%A5%D6%A5%B8%A5%A7%A5%AF%A5%C8%BB%D8%B8%FE\"\u003eオブジェクト指向\u003c/a\u003eが導入されたのはFortran2003かららしいが、ユーザが少ないらしく最適化が後回しにされたりすることもあるらしい。\n自分が実際に触ることはないだろうけど、知らない言語の話を聞くのは面白かった。\n入門部分も書かれているという第一部を買った。\n速習する部分があったので、そこくらいは読んでおきたい。\u003c/p\u003e\n\n\u003cp\u003e出不精なので\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/%BD%A9%CD%D5%B8%B6\"\u003e秋葉原\u003c/a\u003eまでの遠出はつらかったが、普段聞けないことを色々聞けてよかった。\u003c/p\u003e\n\n","slug":"技術書典2に行ってきた"},{"data":{"title":"Pathname#joinの不思議な挙動","published":"2017/01/12","tags":["ruby"]},"content":"\n\u003cp\u003e空のPathname同士をjoinした時に期待と違う挙動があった。\u003c/p\u003e\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003e $ ruby -v\nruby 2.3.3p222 (2016-11-21 revision 56859) [x86_64-darwin16]\u003c/pre\u003e\n\n\n\u003cp\u003e期待していたのは次の動作。\u003c/p\u003e\n\n\u003cpre class=\"code lang-ruby\" data-lang=\"ruby\" data-unlink\u003epath = \u003cspan class=\"synType\"\u003ePathname\u003c/span\u003e.new(\u003cspan class=\"synSpecial\"\u003e''\u003c/span\u003e)         \u003cspan class=\"synComment\"\u003e# =\u0026gt; #\u0026lt;Pathname:\u0026gt;\u003c/span\u003e\npath.join(path)                 \u003cspan class=\"synComment\"\u003e# =\u0026gt; #\u0026lt;Pathname:\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003eでも実際はこうなっていた。\u003c/p\u003e\n\n\u003cpre class=\"code lang-ruby\" data-lang=\"ruby\" data-unlink\u003epath = \u003cspan class=\"synType\"\u003ePathname\u003c/span\u003e.new(\u003cspan class=\"synSpecial\"\u003e''\u003c/span\u003e)         \u003cspan class=\"synComment\"\u003e# =\u0026gt; #\u0026lt;Pathname:\u0026gt;\u003c/span\u003e\npath.join(path)                 \u003cspan class=\"synComment\"\u003e# =\u0026gt; #\u0026lt;Pathname:.\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003e空のPathnameと空のPathnameをjoinしてるんだから空のPathnameが欲しかったのに、 \u003ccode\u003e.\u003c/code\u003e がどこからか出てきてる。\u003cbr/\u003e\nなぜこうなっているんだろう。\u003c/p\u003e\n\n","slug":"Pathname#joinの不思議な挙動"},{"data":{"title":"剰余を使わないFizzBuzz","published":"2016/11/25","tags":["Haskell"]},"content":"\n\u003cp\u003e先日ESMで開かれた\u003ca href=\"https://yochiyochihs.doorkeeper.jp/events/54217\"\u003eよちよち.hs\u003c/a\u003eに参加しました．\u003cbr/\u003e\nそこで剰余を使わずにzip3と無限リストを使って\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/FizzBuzz\"\u003eFizzBuzz\u003c/a\u003eを書く話があったので書いてみました．\u003c/p\u003e\n\n\u003cpre class=\"code lang-haskell\" data-lang=\"haskell\" data-unlink\u003efizzbuzz \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e map fizzbuzz' \u003cspan class=\"synStatement\"\u003e$\u003c/span\u003e zip3 [\u003cspan class=\"synConstant\"\u003e1\u003c/span\u003e\u003cspan class=\"synStatement\"\u003e..\u003c/span\u003e] (cycle [\u003cspan class=\"synConstant\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e,\u003cspan class=\"synConstant\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e,\u003cspan class=\"synConstant\"\u003e\u0026quot;Fizz\u0026quot;\u003c/span\u003e]) (cycle [\u003cspan class=\"synConstant\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e, \u003cspan class=\"synConstant\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e, \u003cspan class=\"synConstant\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e, \u003cspan class=\"synConstant\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e,\u003cspan class=\"synConstant\"\u003e\u0026quot;Buzz\u0026quot;\u003c/span\u003e])\n  \u003cspan class=\"synType\"\u003ewhere\u003c/span\u003e fizzbuzz' (_, \u003cspan class=\"synConstant\"\u003e\u0026quot;Fizz\u0026quot;\u003c/span\u003e, \u003cspan class=\"synConstant\"\u003e\u0026quot;Buzz\u0026quot;\u003c/span\u003e) \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e\u0026quot;FizzBuzz\u0026quot;\u003c/span\u003e\n        fizzbuzz' (_, \u003cspan class=\"synConstant\"\u003e\u0026quot;Fizz\u0026quot;\u003c/span\u003e, _) \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e\u0026quot;Fizz\u0026quot;\u003c/span\u003e\n        fizzbuzz' (_, _, \u003cspan class=\"synConstant\"\u003e\u0026quot;Buzz\u0026quot;\u003c/span\u003e) \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e \u003cspan class=\"synConstant\"\u003e\u0026quot;Buzz\u0026quot;\u003c/span\u003e\n        fizzbuzz' (n, _, _) \u003cspan class=\"synStatement\"\u003e=\u003c/span\u003e show n\n\u003c/pre\u003e\n\n\n\n\n\u003cpre class=\"code\" data-lang=\"\" data-unlink\u003e*Main\u0026gt; take 100 fizzbuzz\n[\u0026#34;1\u0026#34;,\u0026#34;2\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;4\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;7\u0026#34;,\u0026#34;8\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;11\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;13\u0026#34;,\u0026#34;14\u0026#34;,\u0026#34;FizzBuzz\u0026#34;,\u0026#34;16\u0026#34;,\u0026#34;17\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;19\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;22\u0026#34;,\u0026#34;23\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;26\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;28\u0026#34;,\u0026#34;29\u0026#34;,\u0026#34;FizzBuzz\u0026#34;,\u0026#34;31\u0026#34;,\u0026#34;32\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;34\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;37\u0026#34;,\u0026#34;38\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;41\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;43\u0026#34;,\u0026#34;44\u0026#34;,\u0026#34;FizzBuzz\u0026#34;,\u0026#34;46\u0026#34;,\u0026#34;47\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;49\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;52\u0026#34;,\u0026#34;53\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;56\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;58\u0026#34;,\u0026#34;59\u0026#34;,\u0026#34;FizzBuzz\u0026#34;,\u0026#34;61\u0026#34;,\u0026#34;62\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;64\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;67\u0026#34;,\u0026#34;68\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;71\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;73\u0026#34;,\u0026#34;74\u0026#34;,\u0026#34;FizzBuzz\u0026#34;,\u0026#34;76\u0026#34;,\u0026#34;77\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;79\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;82\u0026#34;,\u0026#34;83\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;86\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;88\u0026#34;,\u0026#34;89\u0026#34;,\u0026#34;FizzBuzz\u0026#34;,\u0026#34;91\u0026#34;,\u0026#34;92\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;94\u0026#34;,\u0026#34;Buzz\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;97\u0026#34;,\u0026#34;98\u0026#34;,\u0026#34;Fizz\u0026#34;,\u0026#34;Buzz\u0026#34;]\u003c/pre\u003e\n\n\n\u003cp\u003e無限リストが扱いやすくていいですね．\u003cbr/\u003e\nこういう書き方もあったとは\u003c/p\u003e\n\n","slug":"剰余を使わないFizzBuzz"},{"data":{"title":"Rollbarでbotが出すエラーを無視する","published":"2016/10/19","tags":["Rollbar"]},"content":"\n\u003cp\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/bot\"\u003ebot\u003c/a\u003eから既に削除されたURLへのアクセスがあり，Rollbarのエラーログのノイズがひどかったので，\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/bot\"\u003ebot\u003c/a\u003eからのアクセスで起こった\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ActiveRecord\"\u003eActiveRecord\u003c/a\u003e::RecordNotFoundを無視する設定を書きました．\u003c/p\u003e\n\n\u003cp\u003e上部のバーからSettingsをクリックします．\n\u003ca href=\"https://gyazo.com/0de19f13528995a168e36aeb10adc72b\"\u003e\u003cimg src=\"https://i.gyazo.com/0de19f13528995a168e36aeb10adc72b.png\" alt=\"https://gyazo.com/0de19f13528995a168e36aeb10adc72b\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e次に画面左からGroupingをクリック．\n\u003ca href=\"https://gyazo.com/991020fcbc82e6e917285dcafbbf5a14\"\u003e\u003cimg src=\"https://i.gyazo.com/991020fcbc82e6e917285dcafbbf5a14.png\" alt=\"https://gyazo.com/991020fcbc82e6e917285dcafbbf5a14\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/json\"\u003ejson\u003c/a\u003eでCustom Groupを定義します．\n\u003ca href=\"https://gyazo.com/3f613693a8210aed7ea79e12f3674b08\"\u003e\u003cimg src=\"https://i.gyazo.com/3f613693a8210aed7ea79e12f3674b08.png\" alt=\"https://gyazo.com/3f613693a8210aed7ea79e12f3674b08\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eボットからのアクセスで起こった\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/ActiveRecord\"\u003eActiveRecord\u003c/a\u003e::RecordNotFoundをグルーピングするには次のような\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/json\"\u003ejson\u003c/a\u003eで定義できます．\u003c/p\u003e\n\n\u003cpre class=\"code lang-json\" data-lang=\"json\" data-unlink\u003e\u003cspan class=\"synSpecial\"\u003e[\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e{\u003c/span\u003e\n    \u0026quot;\u003cspan class=\"synStatement\"\u003etitle\u003c/span\u003e\u0026quot;: \u0026quot;\u003cspan class=\"synConstant\"\u003eBot error\u003c/span\u003e\u0026quot;,\n    \u0026quot;\u003cspan class=\"synStatement\"\u003efingerprint\u003c/span\u003e\u0026quot;: \u0026quot;\u003cspan class=\"synConstant\"\u003ebot-error\u003c/span\u003e\u0026quot;,\n    \u0026quot;\u003cspan class=\"synStatement\"\u003econdition\u003c/span\u003e\u0026quot;: \u003cspan class=\"synSpecial\"\u003e{\u003c/span\u003e\n      \u0026quot;\u003cspan class=\"synStatement\"\u003eall\u003c/span\u003e\u0026quot;: \u003cspan class=\"synSpecial\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e{\u003c/span\u003e \u0026quot;\u003cspan class=\"synStatement\"\u003epath\u003c/span\u003e\u0026quot;: \u0026quot;\u003cspan class=\"synConstant\"\u003erequest.headers.User-Agent\u003c/span\u003e\u0026quot;,\n          \u0026quot;\u003cspan class=\"synStatement\"\u003ein\u003c/span\u003e\u0026quot;: \u003cspan class=\"synSpecial\"\u003e[\u003c/span\u003e\n            \u0026quot;\u003cspan class=\"synConstant\"\u003eMozilla/5.0 (compatible; AhrefsBot/5.1; +http://ahrefs.com/robot/)\u003c/span\u003e\u0026quot;,\n            \u0026quot;\u003cspan class=\"synConstant\"\u003eMozilla/5.0 (compatible; Yahoo! Slurp; http://help.yahoo.com/help/us/ysearch/slurp)\u003c/span\u003e\u0026quot;,\n            \u0026quot;\u003cspan class=\"synConstant\"\u003eMozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\u003c/span\u003e\u0026quot;,\n            \u0026quot;\u003cspan class=\"synConstant\"\u003eMozilla/5.0 (iPhone; CPU iPhone OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko) Version/7.0 Mobile/11A465 Safari/9537.53 (compatible; bingbot/2.0; +http://www.bing.com/bingbot.htm)\u003c/span\u003e\u0026quot;,\n            \u0026quot;\u003cspan class=\"synConstant\"\u003eMozilla/5.0 (compatible; Exabot/3.0; +http://www.exabot.com/go/robot)\u003c/span\u003e\u0026quot;\n          \u003cspan class=\"synSpecial\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"synSpecial\"\u003e}\u003c/span\u003e,\n        \u003cspan class=\"synSpecial\"\u003e{\u003c/span\u003e \u0026quot;\u003cspan class=\"synStatement\"\u003epath\u003c/span\u003e\u0026quot;: \u0026quot;\u003cspan class=\"synConstant\"\u003ebody.trace.exception.class\u003c/span\u003e\u0026quot;,\n          \u0026quot;\u003cspan class=\"synStatement\"\u003eeq\u003c/span\u003e\u0026quot;: \u0026quot;\u003cspan class=\"synConstant\"\u003eActiveRecord::RecordNotFound\u003c/span\u003e\u0026quot; \u003cspan class=\"synSpecial\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"synSpecial\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"synSpecial\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"synSpecial\"\u003e}\u003c/span\u003e\n\u003cspan class=\"synSpecial\"\u003e]\u003c/span\u003e\n\u003c/pre\u003e\n\n\n\u003cp\u003eこのpathはOccurrenceのRawJSONで出力されているログのパス。\nリファレンスはこちら。\nin以外にもeqやcontainなどがあります．\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://rollbar.com/docs/custom-grouping/\"\u003ehttps://rollbar.com/docs/custom-grouping/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/JSON\"\u003eJSON\u003c/a\u003eが書けたら入力欄左下にあるボックスにoccurrence IDを入力してマッチさせたいエラーにマッチするか確認できます．\n\u003ca href=\"https://gyazo.com/fa47f8f31caf1ed6cd28c083010b112f\"\u003e\u003cimg src=\"https://i.gyazo.com/fa47f8f31caf1ed6cd28c083010b112f.png\" alt=\"https://gyazo.com/fa47f8f31caf1ed6cd28c083010b112f\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e 次にエラーが起こると\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Bot\"\u003eBot\u003c/a\u003e errorとしてグルーピングされるのでそれをmuteすると\u003ca class=\"keyword\" href=\"http://d.hatena.ne.jp/keyword/Dashboard\"\u003eDashboard\u003c/a\u003eに表示されなくなります．\n逆に特定のエラーグループのlevelをwarningからcriticalに上げることもできたりもします．\u003c/p\u003e\n\n","slug":"Rollbarでbotが出すエラーを無視する"}],"currentPage":1,"pages":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]},"__N_SSG":true},"page":"/posts/pages/[page]","query":{"page":"1"},"buildId":"SXcjlEmjiVUOhB_fdC10N","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>