<!DOCTYPE html><html lang="ja"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>json で nom のお勉強 | (wat-aro)</title><meta name="title" content="json で nom のお勉強 | (wat-aro)"/><meta name="description" content="旧ブログの `movable type` を `markdown` に変換したい。  [nom](https://github.com/Geal/nom) でパースしようと思ったが Readme を読んでもいまいちしっくりこない。  parsec と同じようにはできませんか。とりあえず練習がてら何かをパースしてみる。 "/><meta property="og:locale" content="ja_jp"/><meta property="og:type" content="article"/><meta property="og:site_name" content="(wat-aro)"/><meta property="og:title" content="json で nom のお勉強 | (wat-aro)"/><meta property="og:image" content="https://wat-aro.dev/og-images/study-nom-by-json.png"/><meta property="og:url" content="https://wat-aro.dev/posts/study-nom-by-json"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@wat_aro"/><meta name="twitter:creator" content="@wat_aro"/><meta name="twitter:title" content="json で nom のお勉強 | (wat-aro)"/><meta name="twitter:description" content="旧ブログの `movable type` を `markdown` に変換したい。  [nom](https://github.com/Geal/nom) でパースしようと思ったが Readme を読んでもいまいちしっくりこない。  parsec と同じようにはできませんか。とりあえず練習がてら何かをパースしてみる。 "/><meta name="twitter:image" content="https://wat-aro.dev/og-images/study-nom-by-json.png"/><meta name="next-head-count" content="17"/><link rel="icon" href="/images/favicon.ico"/><link rel="preload" href="/_next/static/css/800ac92406fecd2e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/800ac92406fecd2e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-fc7d2f0e2098927e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c0d903a3b476b773.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-4aeb4cf8af40ad4b.js" defer=""></script><script src="/_next/static/R84RSauZ3JCDZekJfkMOf/_buildManifest.js" defer=""></script><script src="/_next/static/R84RSauZ3JCDZekJfkMOf/_ssgManifest.js" defer=""></script><script src="/_next/static/R84RSauZ3JCDZekJfkMOf/_middlewareManifest.js" defer=""></script></head><body><noscript>
            <iframe
              src="https://www.googletagmanager.com/ns.html?id=GTM-MW6D56L"
              height="0"
              width="0"
              style="display:none;visibility:hidden"
            /></noscript><div id="__next"><div class="py-0 md:px-8 min-h-screen flex flex-col items-center"><div class="top-0 bg-white w-full h-16 flex flex-row justify-between items-center px-4 border-b-2"><a href="/"><div class="flex items-center font-midium text-3xl h-full font-bold gap-4"><img class="rounded-full" src="/images/profile.jpg" width="48" height="48" alt="profile image"/>(wat-aro)<!-- --></div></a><ul class="flex gap-3 h-full"><li class="h-full  flex flex-col justify-end border-black pb-4"><a href="/about">About</a></li><li class="h-full  flex flex-col justify-end border-black pb-3 border-b-4"><a href="/posts">Blog</a></li></ul></div><div class="flex md:justify-center justify-between w-full"><div class="flex flex-col sm:max-w-sm md:max-w-4xl w-full py-4 px-4"><article class="flex max-w-4xl w-full"><div class="py-4 w-full"><div class="mr-2 text-xs font-bold">2022/05/16</div><h1 class="font-bold text-3xl text-black">json で nom のお勉強</h1><nav class="flex mt-2 mb-2 items-start text-gray-500 text-xs"><div class="flex flex-nowrap max-w-full overflow-x-auto"><p class="mr-1 rounded-full px-2 py-1 border leading-none">Rust</p><p class="mr-1 rounded-full px-2 py-1 border leading-none">nom</p></div></nav><div class="znc"><p>旧ブログの <code>movable type</code> を <code>markdown</code> に変換したい。<br>
<a href="https://github.com/Geal/nom">nom</a> でパースしようと思ったが Readme を読んでもいまいちしっくりこない。<br>
parsec と同じようにはできませんか。
とりあえず練習がてら何かをパースしてみる。<br>
仕様があるほうが嬉しいので探してみると <a href="https://www.json.org/json-ja.html">json</a> がよさそうだった。<br>
まずは <code>digits</code> を書いてみた。<br>
<a href="https://docs.rs/nom/latest/nom/character/complete/fn.digit1.html">digit1</a> を使えば終わりなのだが、それでは練習にならないため定義通りに実装。</p>
<p><a href="https://github.com/wat-aro/wjson">https://github.com/wat-aro/wjson</a></p>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">fn</span> <span class="token function-definition function">zero</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">IResult</span><span class="token operator">&#x3C;</span><span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">,</span> <span class="token keyword">u64</span><span class="token operator">></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token closure-punctuation punctuation">|</span></span> c<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token keyword">u64</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function-definition function">onenine</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">IResult</span><span class="token operator">&#x3C;</span><span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">,</span> <span class="token keyword">u64</span><span class="token operator">></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">map</span><span class="token punctuation">(</span>
</span><span class="code-line">        <span class="token function">alt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token char">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token char">'2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token char">'3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token char">'4'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token char">'5'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token char">'6'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token char">'7'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token char">'8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token char">'9'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token closure-punctuation punctuation">|</span></span> c<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token keyword">u64</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">)</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">digit</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">IResult</span><span class="token operator">&#x3C;</span><span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">,</span> <span class="token keyword">u64</span><span class="token operator">></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">alt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>zero<span class="token punctuation">,</span> onenine<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">digits</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">IResult</span><span class="token operator">&#x3C;</span><span class="token operator">&#x26;</span><span class="token keyword">str</span><span class="token punctuation">,</span> <span class="token keyword">u64</span><span class="token operator">></span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token punctuation">(</span>rest<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">many1</span><span class="token punctuation">(</span>digit<span class="token punctuation">)</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> str_vec<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>d<span class="token closure-punctuation punctuation">|</span></span> d<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token class-name">String</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rest<span class="token punctuation">,</span> str_vec<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>まだ <code>Rust</code> を書き慣れていないけれど楽しい。</p></div></div></article></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"json で nom のお勉強","published":"2022/05/16","tags":["Rust","nom"],"content":"\u003cp\u003e旧ブログの \u003ccode\u003emovable type\u003c/code\u003e を \u003ccode\u003emarkdown\u003c/code\u003e に変換したい。\u003cbr\u003e\n\u003ca href=\"https://github.com/Geal/nom\"\u003enom\u003c/a\u003e でパースしようと思ったが Readme を読んでもいまいちしっくりこない。\u003cbr\u003e\nparsec と同じようにはできませんか。\nとりあえず練習がてら何かをパースしてみる。\u003cbr\u003e\n仕様があるほうが嬉しいので探してみると \u003ca href=\"https://www.json.org/json-ja.html\"\u003ejson\u003c/a\u003e がよさそうだった。\u003cbr\u003e\nまずは \u003ccode\u003edigits\u003c/code\u003e を書いてみた。\u003cbr\u003e\n\u003ca href=\"https://docs.rs/nom/latest/nom/character/complete/fn.digit1.html\"\u003edigit1\u003c/a\u003e を使えば終わりなのだが、それでは練習にならないため定義通りに実装。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/wat-aro/wjson\"\u003ehttps://github.com/wat-aro/wjson\u003c/a\u003e\u003c/p\u003e\n\u003cpre class=\"language-rust\"\u003e\u003ccode class=\"language-rust code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003ezero\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einput\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIResult\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eu64\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token char\"\u003e'0'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token closure-params\"\u003e\u003cspan class=\"token closure-punctuation punctuation\"\u003e|\u003c/span\u003ec\u003cspan class=\"token closure-punctuation punctuation\"\u003e|\u003c/span\u003e\u003c/span\u003e c\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eto_string\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eparse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eu64\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eunwrap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einput\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003eonenine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einput\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIResult\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eu64\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token function\"\u003ealt\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token char\"\u003e'1'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token char\"\u003e'2'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token char\"\u003e'3'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token char\"\u003e'4'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token char\"\u003e'5'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token char\"\u003e'6'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token char\"\u003e'7'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token char\"\u003e'8'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token char\"\u003e'9'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token closure-params\"\u003e\u003cspan class=\"token closure-punctuation punctuation\"\u003e|\u003c/span\u003ec\u003cspan class=\"token closure-punctuation punctuation\"\u003e|\u003c/span\u003e\u003c/span\u003e c\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eto_string\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eparse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eu64\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eunwrap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einput\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003epub\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003edigit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einput\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIResult\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eu64\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token function\"\u003ealt\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ezero\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e onenine\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einput\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003epub\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003edigits\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einput\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIResult\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eu64\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erest\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003emany1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edigit\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einput\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e str_vec\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eiter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token closure-params\"\u003e\u003cspan class=\"token closure-punctuation punctuation\"\u003e|\u003c/span\u003ed\u003cspan class=\"token closure-punctuation punctuation\"\u003e|\u003c/span\u003e\u003c/span\u003e d\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eto_string\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecollect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token class-name\"\u003eOk\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erest\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e str_vec\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eparse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eunwrap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eまだ \u003ccode\u003eRust\u003c/code\u003e を書き慣れていないけれど楽しい。\u003c/p\u003e","slug":"study-nom-by-json","rawContent":"\n旧ブログの `movable type` を `markdown` に変換したい。  \n[nom](https://github.com/Geal/nom) でパースしようと思ったが Readme を読んでもいまいちしっくりこない。  \nparsec と同じようにはできませんか。\nとりあえず練習がてら何かをパースしてみる。  \n仕様があるほうが嬉しいので探してみると [json](https://www.json.org/json-ja.html) がよさそうだった。  \nまずは `digits` を書いてみた。  \n[digit1](https://docs.rs/nom/latest/nom/character/complete/fn.digit1.html) を使えば終わりなのだが、それでは練習にならないため定義通りに実装。\n\nhttps://github.com/wat-aro/wjson\n\n```rust\nfn zero(input: \u0026str) -\u003e IResult\u003c\u0026str, u64\u003e {\n    map(char('0'), |c| c.to_string().parse::\u003cu64\u003e().unwrap())(input)\n}\n\nfn onenine(input: \u0026str) -\u003e IResult\u003c\u0026str, u64\u003e {\n    map(\n        alt((\n            char('1'),\n            char('2'),\n            char('3'),\n            char('4'),\n            char('5'),\n            char('6'),\n            char('7'),\n            char('8'),\n            char('9'),\n        )),\n        |c| c.to_string().parse::\u003cu64\u003e().unwrap(),\n    )(input)\n}\n\npub fn digit(input: \u0026str) -\u003e IResult\u003c\u0026str, u64\u003e {\n    alt((zero, onenine))(input)\n}\n\npub fn digits(input: \u0026str) -\u003e IResult\u003c\u0026str, u64\u003e {\n    let (rest, v) = many1(digit)(input)?;\n    let str_vec: String = v.iter().map(|d| d.to_string()).collect::\u003cString\u003e();\n\n    Ok((rest, str_vec.parse().unwrap()))\n}\n```\n\nまだ `Rust` を書き慣れていないけれど楽しい。\n"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"study-nom-by-json"},"buildId":"R84RSauZ3JCDZekJfkMOf","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>